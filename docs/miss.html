<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Missing Data and Single Imputation | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</title>
<meta name="author" content="Thomas E. Love">
<meta name="description" content="Almost all serious statistical analyses have to deal with missing data. Data values that are missing are indicated in R, and to R, by the symbol NA. We’ll focus on tools from the naniar and...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 8 Missing Data and Single Imputation | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta property="og:type" content="book">
<meta property="og:url" content="your book url like https://thomaselove.github.io/431-book/miss.html">
<meta property="og:description" content="Almost all serious statistical analyses have to deal with missing data. Data values that are missing are indicated in R, and to R, by the symbol NA. We’ll focus on tools from the naniar and...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Missing Data and Single Imputation | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta name="twitter:description" content="Almost all serious statistical analyses have to deal with missing data. Data values that are missing are indicated in R, and to R, by the symbol NA. We’ll focus on tools from the naniar and...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Working with These Notes</a></li>
<li><a class="" href="data-science.html"><span class="header-section-number">1</span> Data Science</a></li>
<li class="book-part">Part A. Exploring Data</li>
<li><a class="" href="the-palmer-penguins.html"><span class="header-section-number">2</span> The Palmer Penguins</a></li>
<li><a class="" href="nhanes1.html"><span class="header-section-number">3</span> NHANES: A First Look</a></li>
<li><a class="" href="data-structures-variable-types-sampling-nhanes.html"><span class="header-section-number">4</span> Data Structures, Variable Types &amp; Sampling NHANES</a></li>
<li><a class="" href="visualizing-nhanes-data.html"><span class="header-section-number">5</span> Visualizing NHANES Data</a></li>
<li><a class="" href="summarizing_quantities.html"><span class="header-section-number">6</span> Summarizing Quantities</a></li>
<li><a class="" href="summarizing-categories.html"><span class="header-section-number">7</span> Summarizing Categories</a></li>
<li><a class="active" href="miss.html"><span class="header-section-number">8</span> Missing Data and Single Imputation</a></li>
<li><a class="" href="NYFS-Study.html"><span class="header-section-number">9</span> National Youth Fitness Survey</a></li>
<li><a class="" href="assessing-normality.html"><span class="header-section-number">10</span> Assessing Normality</a></li>
<li><a class="" href="straight-line-models.html"><span class="header-section-number">11</span> Straight Line Models</a></li>
<li><a class="" href="linearizing-transformations.html"><span class="header-section-number">12</span> Linearizing Transformations</a></li>
<li><a class="" href="studying-crab-claws-crabs.html"><span class="header-section-number">13</span> Studying Crab Claws (crabs)</a></li>
<li><a class="" href="Hydrate-Study.html"><span class="header-section-number">14</span> Dehydration Recovery</a></li>
<li><a class="" href="WCGS-Study.html"><span class="header-section-number">15</span> The WCGS</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="some-r-tips.html">Some R Tips</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/THOMASELOVE/431-notes">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="miss" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Missing Data and Single Imputation<a class="anchor" aria-label="anchor" href="#miss"><i class="fas fa-link"></i></a>
</h1>
<p>Almost all serious statistical analyses have to deal with missing data. Data values that are missing are indicated in R, and to R, by the symbol <code>NA</code>.</p>
<p>We’ll focus on tools from the <code>naniar</code> and <code>simputation</code> packages in this work.</p>
<div id="a-simulated-example-with-15-subjects" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> A Simulated Example with 15 subjects<a class="anchor" aria-label="anchor" href="#a-simulated-example-with-15-subjects"><i class="fas fa-link"></i></a>
</h2>
<p>In the following tiny data set called <code>sbp_example</code>, we have four variables for a set of 15 subjects. In addition to a subject id, we have:</p>
<ul>
<li>the treatment this subject received (A, B or C are the treatments),</li>
<li>an indicator (1 = yes, 0 = no) of whether the subject has diabetes,</li>
<li>the subject’s systolic blood pressure at baseline</li>
<li>the subject’s systolic blood pressure after the application of the treatment</li>
</ul>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create some temporary variables</span>
<span class="va">subject</span> <span class="op">&lt;-</span> <span class="fl">101</span><span class="op">:</span><span class="fl">115</span>
<span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="cn">NA</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>
<span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="cn">NA</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>
<span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">145</span>, <span class="fl">150</span>, <span class="cn">NA</span>, <span class="fl">155</span>, <span class="cn">NA</span>, <span class="fl">135</span>, <span class="cn">NA</span>, <span class="fl">115</span>, <span class="fl">170</span>, <span class="fl">150</span>, <span class="fl">145</span>, <span class="fl">140</span>, <span class="fl">160</span>, <span class="fl">135</span><span class="op">)</span>
<span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">105</span>, <span class="fl">135</span>, <span class="fl">150</span>, <span class="fl">120</span>, <span class="fl">135</span>, <span class="fl">115</span>, <span class="fl">160</span>, <span class="fl">150</span>, <span class="fl">130</span>, <span class="fl">155</span>, <span class="fl">140</span>, <span class="fl">140</span>, <span class="fl">150</span>, <span class="fl">135</span>, <span class="fl">120</span><span class="op">)</span>

<span class="va">sbp_example</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">subject</span>, treat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span>, diabetes <span class="op">=</span> <span class="va">x2</span>, 
         sbp.before <span class="op">=</span> <span class="va">x3</span>, sbp.after <span class="op">=</span> <span class="va">x4</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">subject</span>, <span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span>, <span class="va">x4</span><span class="op">)</span> <span class="co"># just cleaning up</span>

<span class="va">sbp_example</span></code></pre></div>
<pre><code># A tibble: 15 x 5
   subject treat diabetes sbp.before sbp.after
     &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1     101 A            1        120       105
 2     102 B            0        145       135
 3     103 C            0        150       150
 4     104 A            1         NA       120
 5     105 C           NA        155       135
 6     106 A            1         NA       115
 7     107 A            0        135       160
 8     108 &lt;NA&gt;         1         NA       150
 9     109 B           NA        115       130
10     110 C            1        170       155
11     111 A            0        150       140
12     112 B            0        145       140
13     113 C            1        140       150
14     114 A            1        160       135
15     115 B           NA        135       120</code></pre>
</div>
<div id="identifying-missingness-with-naniar-functions" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Identifying missingness with <code>naniar</code> functions<a class="anchor" aria-label="anchor" href="#identifying-missingness-with-naniar-functions"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>naniar</code> package has many useful functions.</p>
<ol style="list-style-type: decimal">
<li>How many missing values do we have, overall?</li>
</ol>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/n_miss.html">n_miss</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 7</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>How many variables have missing values, overall?</li>
</ol>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/n-var-case-miss.html">n_var_miss</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 3</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Which variables contain missing values?</li>
</ol>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/miss_var_which.html">miss_var_which</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code>[1] "treat"      "diabetes"   "sbp.before"</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>How many missing values do we have in each variable?</li>
</ol>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/miss_var_summary.html">miss_var_summary</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 5 x 3
  variable   n_miss pct_miss
  &lt;chr&gt;       &lt;int&gt;    &lt;dbl&gt;
1 diabetes        3    20   
2 sbp.before      3    20   
3 treat           1     6.67
4 subject         0     0   
5 sbp.after       0     0   </code></pre>
<p>We are missing one <code>treat</code>, 3 <code>diabetes</code> and 3 <code>sbp.before</code> values.</p>
<ol start="5" style="list-style-type: decimal">
<li>Can we plot missingness, by variable?</li>
</ol>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/gg_miss_var.html">gg_miss_var</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code>Warning: It is deprecated to specify `guide = FALSE` to
remove a guide. Please use `guide = "none"` instead.</code></pre>
<div class="inline-figure"><img src="08-missing_data_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<ol start="6" style="list-style-type: decimal">
<li>How many of the cases (rows) have missing values?</li>
</ol>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/n-var-case-miss.html">n_case_miss</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 6</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>How many cases have complete data, with no missing values?</li>
</ol>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/n-var-case-complete.html">n_case_complete</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 9</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Can we tabulate missingness by case?</li>
</ol>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/miss_case_table.html">miss_case_table</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 3 x 3
  n_miss_in_case n_cases pct_cases
           &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;
1              0       9     60   
2              1       5     33.3 
3              2       1      6.67</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Which cases have missing values?</li>
</ol>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/naniar/man/miss_case_summary.html">miss_case_summary</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 15 x 3
    case n_miss pct_miss
   &lt;int&gt;  &lt;int&gt;    &lt;dbl&gt;
 1     8      2       40
 2     4      1       20
 3     5      1       20
 4     6      1       20
 5     9      1       20
 6    15      1       20
 7     1      0        0
 8     2      0        0
 9     3      0        0
10     7      0        0
11    10      0        0
12    11      0        0
13    12      0        0
14    13      0        0
15    14      0        0</code></pre>
<ol start="10" style="list-style-type: decimal">
<li>How can we identify the subjects with missing data?</li>
</ol>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sbp_example</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 6 x 5
  subject treat diabetes sbp.before sbp.after
    &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
1     104 A            1         NA       120
2     105 C           NA        155       135
3     106 A            1         NA       115
4     108 &lt;NA&gt;         1         NA       150
5     109 B           NA        115       130
6     115 B           NA        135       120</code></pre>
<p>We have nine subjects with complete data, three subjects with missing <code>diabetes</code> (only), two subjects with missing <code>sbp.before</code> (only), and 1 subject who is missing both <code>treat</code> and <code>sbp.before</code>.</p>
</div>
<div id="missing-data-mechanisms" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Missing-data mechanisms<a class="anchor" aria-label="anchor" href="#missing-data-mechanisms"><i class="fas fa-link"></i></a>
</h2>
<p>My source for this description of mechanisms is Chapter 25 of <span class="citation"><a href="references.html#ref-Gelman-Hill" role="doc-biblioref">Andrew Gelman and Jennifer Hill</a>,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-Gelman-Hill" role="doc-biblioref"&gt;&lt;em&gt;Data Analysis Using Regression and Multilevel-Hierarchical Models&lt;/em&gt; (New York: Cambridge University Press, 2007), &lt;/a&gt;&lt;a href="http://www.stat.columbia.edu/~gelman/arm/" role="doc-biblioref"&gt;http://www.stat.columbia.edu/~gelman/arm/&lt;/a&gt;.&lt;/p&gt;'><sup>28</sup></a></span> and that chapter is <a href="http://www.stat.columbia.edu/~gelman/arm/missing.pdf">available at this link</a>.</p>
<ol style="list-style-type: decimal">
<li>
<strong>MCAR = Missingness completely at random</strong>. A variable is missing completely at random if the probability of missingness is the same for all units, for example, if for each subject, we decide whether to collect the <code>diabetes</code> status by rolling a die and refusing to answer if a “6” shows up. If data are missing completely at random, then throwing out cases with missing data does not bias your inferences.</li>
<li>
<strong>Missingness that depends only on observed predictors</strong>. A more general assumption, called <strong>missing at random</strong> or <strong>MAR</strong>, is that the probability a variable is missing depends only on available information. Here, we would have to be willing to assume that the probability of nonresponse to <code>diabetes</code> depends only on the other, fully recorded variables in the data. It is often reasonable to model this process as a logistic regression, where the outcome variable equals 1 for observed cases and 0 for missing. When an outcome variable is missing at random, it is acceptable to exclude the missing cases (that is, to treat them as NA), as long as the regression controls for all the variables that affect the probability of missingness.</li>
<li>
<strong>Missingness that depends on unobserved predictors</strong>. Missingness is no longer “at random” if it depends on information that has not been recorded and this information also predicts the missing values. If a particular treatment causes discomfort, a patient is more likely to drop out of the study. This missingness is not at random (unless “discomfort” is measured and observed for all patients). If missingness is not at random, it must be explicitly modeled, or else you must accept some bias in your inferences.</li>
<li>
<strong>Missingness that depends on the missing value itself.</strong> Finally, a particularly difficult situation arises when the probability of missingness depends on the (potentially missing) variable itself. For example, suppose that people with higher earnings are less likely to reveal them.</li>
</ol>
<p>Essentially, situations 3 and 4 are referred to collectively as <strong>non-random missingness</strong>, and cause more trouble for us than 1 and 2.</p>
</div>
<div id="options-for-dealing-with-missingness" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Options for Dealing with Missingness<a class="anchor" aria-label="anchor" href="#options-for-dealing-with-missingness"><i class="fas fa-link"></i></a>
</h2>
<p>There are several available methods for dealing with missing data that are MCAR or MAR, but they basically boil down to:</p>
<ul>
<li>Complete Case (or Available Case) analyses</li>
<li>Single Imputation</li>
<li>Multiple Imputation</li>
</ul>
</div>
<div id="complete-case-and-available-case-analyses" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Complete Case (and Available Case) analyses<a class="anchor" aria-label="anchor" href="#complete-case-and-available-case-analyses"><i class="fas fa-link"></i></a>
</h2>
<p>In <strong>Complete Case</strong> analyses, rows containing NA values are omitted from the data before analyses commence. This is the default approach for many statistical software packages, and may introduce unpredictable bias and fail to include some useful, often hard-won information.</p>
<ul>
<li>A complete case analysis can be appropriate when the number of missing observations is not large, and the missing pattern is either MCAR (missing completely at random) or MAR (missing at random.)</li>
<li>Two problems arise with complete-case analysis:
<ol style="list-style-type: decimal">
<li>If the units with missing values differ systematically from the completely observed cases, this could bias the complete-case analysis.</li>
<li>If many variables are included in a model, there may be very few complete cases, so that most of the data would be discarded for the sake of a straightforward analysis.</li>
</ol>
</li>
<li>A related approach is <em>available-case</em> analysis where different aspects of a problem are studied with different subsets of the data, perhaps identified on the basis of what is missing in them.</li>
</ul>
</div>
<div id="single-imputation" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Single Imputation<a class="anchor" aria-label="anchor" href="#single-imputation"><i class="fas fa-link"></i></a>
</h2>
<p>In <strong>single imputation</strong> analyses, NA values are estimated/replaced <em>one time</em> with <em>one particular data value</em> for the purpose of obtaining more complete samples, at the expense of creating some potential bias in the eventual conclusions or obtaining slightly <em>less</em> accurate estimates than would be available if there were no missing values in the data.</p>
<ul>
<li>A single imputation can be just a replacement with the mean or median (for a quantity) or the mode (for a categorical variable.) However, such an approach, though easy to understand, underestimates variance and ignores the relationship of missing values to other variables.</li>
<li>Single imputation can also be done using a variety of models to try to capture information about the NA values that are available in other variables within the data set.</li>
<li>The <code>simputation</code> package can help us execute single imputations using a wide variety of techniques, within the pipe approach used by the <code>tidyverse</code>. Another approach I have used in the past is the <code>mice</code> package, which can also perform single imputations.</li>
</ul>
</div>
<div id="multiple-imputation" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Multiple Imputation<a class="anchor" aria-label="anchor" href="#multiple-imputation"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Multiple imputation</strong>, where NA values are repeatedly estimated/replaced with multiple data values, for the purpose of obtaining mode complete samples <em>and</em> capturing details of the variation inherent in the fact that the data have missingness, so as to obtain <em>more</em> accurate estimates than are possible with single imputation.</p>
<ul>
<li>We’ll postpone further discussion of multiple imputation to later in the semester.</li>
</ul>
</div>
<div id="building-a-complete-case-analysis" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Building a Complete Case Analysis<a class="anchor" aria-label="anchor" href="#building-a-complete-case-analysis"><i class="fas fa-link"></i></a>
</h2>
<p>We can drop all of the missing values from a data set with <code>drop_na</code> or with <code>na.omit</code> or by filtering for <code>complete.cases</code>. Any of these approaches produces the same result - a new data set with 9 rows (after dropping the six subjects with any NA values) and 5 columns.</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cc.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">sbp_example</span><span class="op">)</span>
<span class="va">cc.2</span> <span class="op">&lt;-</span> <span class="va">sbp_example</span> <span class="op">%&gt;%</span> <span class="va">drop_na</span>
<span class="va">cc.3</span> <span class="op">&lt;-</span> <span class="va">sbp_example</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="single-imputation-with-the-mean-or-mode" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Single Imputation with the Mean or Mode<a class="anchor" aria-label="anchor" href="#single-imputation-with-the-mean-or-mode"><i class="fas fa-link"></i></a>
</h2>
<p>The most straightforward approach to single imputation is to impute a single summary of the variable, such as the mean, median or mode.</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mosaic</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">favstats</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sbp.before</span>, data <span class="op">=</span> <span class="va">sbp_example</span><span class="op">)</span></code></pre></div>
<pre><code> min  Q1 median     Q3 max     mean       sd  n missing
 115 135    145 151.25 170 143.3333 15.71527 12       3</code></pre>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sbp_example</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">diabetes</span>, <span class="va">treat</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_totals.html">adorn_totals</a></span><span class="op">(</span>where <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"row"</span>, <span class="st">"col"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code> diabetes A B C NA_ Total
        0 2 2 1   0     5
        1 4 0 2   1     7
     &lt;NA&gt; 0 2 1   0     3
    Total 6 4 4   1    15</code></pre>
<p>Here, suppose we decide to impute</p>
<ul>
<li>
<code>sbp.before</code> with the mean (143.3) among non-missing values,</li>
<li>
<code>diabetes</code> with its more common value, 1, and</li>
<li>
<code>treat</code> with its more common value, or mode (A)</li>
</ul>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">si.1</span> <span class="op">&lt;-</span> <span class="va">sbp_example</span> <span class="op">%&gt;%</span>
    <span class="fu">replace_na</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sbp.before <span class="op">=</span> <span class="fl">143.33</span>,
                    diabetes <span class="op">=</span> <span class="fl">1</span>,
                    treat <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span><span class="op">)</span>
<span class="va">si.1</span></code></pre></div>
<pre><code># A tibble: 15 x 5
   subject treat diabetes sbp.before sbp.after
     &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1     101 A            1       120        105
 2     102 B            0       145        135
 3     103 C            0       150        150
 4     104 A            1       143.       120
 5     105 C            1       155        135
 6     106 A            1       143.       115
 7     107 A            0       135        160
 8     108 A            1       143.       150
 9     109 B            1       115        130
10     110 C            1       170        155
11     111 A            0       150        140
12     112 B            0       145        140
13     113 C            1       140        150
14     114 A            1       160        135
15     115 B            1       135        120</code></pre>
</div>
<div id="doing-single-imputation-with-simputation" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> Doing Single Imputation with <code>simputation</code><a class="anchor" aria-label="anchor" href="#doing-single-imputation-with-simputation"><i class="fas fa-link"></i></a>
</h2>
<p>Single imputation is a potentially appropriate method when missingness can be assumed to be either completely at random (MCAR) or dependent only on observed predictors (MAR). We’ll use the <code>simputation</code> package to accomplish it.</p>
<ul>
<li>The <code>simputation</code> vignette is available at <a href="https://cran.r-project.org/web/packages/simputation/vignettes/intro.html" class="uri">https://cran.r-project.org/web/packages/simputation/vignettes/intro.html</a>
</li>
<li>The <code>simputation</code> reference manual is available at <a href="https://cran.r-project.org/web/packages/simputation/simputation.pdf" class="uri">https://cran.r-project.org/web/packages/simputation/simputation.pdf</a>
</li>
</ul>
<p>Suppose we wanted to use:</p>
<ul>
<li>a robust linear model to predict <code>sbp.before</code> missing values, on the basis of <code>sbp.after</code> and <code>diabetes</code> status, and</li>
<li>a predictive mean matching approach (which, unlike the robust linear model, will ensure that only values of <code>diabetes</code> that we’ve seen before will be imputed) to predict <code>diabetes</code> status, on the basis of <code>sbp.after</code>, and</li>
<li>a decision tree approach to predict <code>treat</code> status, using all other variables in the data</li>
</ul>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">50001</span><span class="op">)</span>

<span class="va">imp.2</span> <span class="op">&lt;-</span> <span class="va">sbp_example</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_lm.html">impute_rlm</a></span><span class="op">(</span><span class="va">sbp.before</span> <span class="op">~</span> <span class="va">sbp.after</span> <span class="op">+</span> <span class="va">diabetes</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_hotdeck.html">impute_pmm</a></span><span class="op">(</span><span class="va">diabetes</span> <span class="op">~</span> <span class="va">sbp.after</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/simputation/man/impute_tree.html">impute_cart</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span>

<span class="va">imp.2</span></code></pre></div>
<pre><code># A tibble: 15 x 5
   subject treat diabetes sbp.before sbp.after
 *   &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1     101 A            1       120        105
 2     102 B            0       145        135
 3     103 C            0       150        150
 4     104 A            1       139.       120
 5     105 C            1       155        135
 6     106 A            1       136.       115
 7     107 A            0       135        160
 8     108 A            1       155.       150
 9     109 B            1       115        130
10     110 C            1       170        155
11     111 A            0       150        140
12     112 B            0       145        140
13     113 C            1       140        150
14     114 A            1       160        135
15     115 B            1       135        120</code></pre>
<p>Details on the many available methods in <code>simputation</code> are provided <a href="https://cran.r-project.org/web/packages/simputation/simputation.pdf">in its manual</a>. These include:</p>
<ul>
<li>
<code>impute_cart</code> uses a Classification and Regression Tree approach for numerical or categorical data. There is also an <code>impute_rf</code> command which uses Random Forests for imputation.</li>
<li>
<code>impute_pmm</code> is one of several “hot deck” options for imputation, this one is predictive mean matching, which can be used with numeric data (only). Missing values are first imputed using a predictive model. Next, these predictions are replaced with the observed values which are nearest to the prediction. Other imputation options in this group include random hot deck, sequential hot deck and k-nearest neighbor imputation.</li>
<li>
<code>impute_rlm</code> is one of several regression imputation methods, including linear models, robust linear models (which use what is called M-estimation to impute numerical variables) and lasso/elastic net/ridge regression models.</li>
</ul>
<p>The <code>simputation</code> package can also do EM-based multivariate imputation, and multivariate random forest imputation, and several other approaches.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="summarizing-categories.html"><span class="header-section-number">7</span> Summarizing Categories</a></div>
<div class="next"><a href="NYFS-Study.html"><span class="header-section-number">9</span> National Youth Fitness Survey</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#miss"><span class="header-section-number">8</span> Missing Data and Single Imputation</a></li>
<li><a class="nav-link" href="#a-simulated-example-with-15-subjects"><span class="header-section-number">8.1</span> A Simulated Example with 15 subjects</a></li>
<li><a class="nav-link" href="#identifying-missingness-with-naniar-functions"><span class="header-section-number">8.2</span> Identifying missingness with naniar functions</a></li>
<li><a class="nav-link" href="#missing-data-mechanisms"><span class="header-section-number">8.3</span> Missing-data mechanisms</a></li>
<li><a class="nav-link" href="#options-for-dealing-with-missingness"><span class="header-section-number">8.4</span> Options for Dealing with Missingness</a></li>
<li><a class="nav-link" href="#complete-case-and-available-case-analyses"><span class="header-section-number">8.5</span> Complete Case (and Available Case) analyses</a></li>
<li><a class="nav-link" href="#single-imputation"><span class="header-section-number">8.6</span> Single Imputation</a></li>
<li><a class="nav-link" href="#multiple-imputation"><span class="header-section-number">8.7</span> Multiple Imputation</a></li>
<li><a class="nav-link" href="#building-a-complete-case-analysis"><span class="header-section-number">8.8</span> Building a Complete Case Analysis</a></li>
<li><a class="nav-link" href="#single-imputation-with-the-mean-or-mode"><span class="header-section-number">8.9</span> Single Imputation with the Mean or Mode</a></li>
<li><a class="nav-link" href="#doing-single-imputation-with-simputation"><span class="header-section-number">8.10</span> Doing Single Imputation with simputation</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/THOMASELOVE/431-notes/blob/master/08-missing_data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/THOMASELOVE/431-notes/edit/master/08-missing_data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</strong>" was written by Thomas E. Love. It was last built on 2021-09-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
