<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 Straight Line Models | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</title>
<meta name="author" content="Thomas E. Love">
<meta name="description" content='11.1 Assessing A Scatterplot Let’s consider the relationship of protein and fat consumption for children in the nnyfs data. nnyfs &lt;- read_rds("data/nnyfs.Rds") We’ll begin our investigation, as we...'>
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 11 Straight Line Models | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta property="og:type" content="book">
<meta property="og:url" content="https://thomaselove.github.io/431-notes/straight-line-models.html">
<meta property="og:description" content='11.1 Assessing A Scatterplot Let’s consider the relationship of protein and fat consumption for children in the nnyfs data. nnyfs &lt;- read_rds("data/nnyfs.Rds") We’ll begin our investigation, as we...'>
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 Straight Line Models | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta name="twitter:description" content='11.1 Assessing A Scatterplot Let’s consider the relationship of protein and fat consumption for children in the nnyfs data. nnyfs &lt;- read_rds("data/nnyfs.Rds") We’ll begin our investigation, as we...'>
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Working with These Notes</a></li>
<li><a class="" href="data-science.html"><span class="header-section-number">1</span> Data Science</a></li>
<li class="book-part">Part A. Exploring Data</li>
<li><a class="" href="the-palmer-penguins.html"><span class="header-section-number">2</span> The Palmer Penguins</a></li>
<li><a class="" href="nhanes1.html"><span class="header-section-number">3</span> NHANES: A First Look</a></li>
<li><a class="" href="data-structures-variable-types-sampling-nhanes.html"><span class="header-section-number">4</span> Data Structures, Variable Types &amp; Sampling NHANES</a></li>
<li><a class="" href="visualizing-nhanes-data.html"><span class="header-section-number">5</span> Visualizing NHANES Data</a></li>
<li><a class="" href="summarizing_quantities.html"><span class="header-section-number">6</span> Summarizing Quantities</a></li>
<li><a class="" href="summarizing-categories.html"><span class="header-section-number">7</span> Summarizing Categories</a></li>
<li><a class="" href="miss.html"><span class="header-section-number">8</span> Missing Data and Single Imputation</a></li>
<li><a class="" href="NYFS-Study.html"><span class="header-section-number">9</span> National Youth Fitness Survey</a></li>
<li><a class="" href="assessing-normality.html"><span class="header-section-number">10</span> Assessing Normality</a></li>
<li><a class="active" href="straight-line-models.html"><span class="header-section-number">11</span> Straight Line Models</a></li>
<li><a class="" href="linearizing-transformations.html"><span class="header-section-number">12</span> Linearizing Transformations</a></li>
<li><a class="" href="studying-crab-claws-crabs.html"><span class="header-section-number">13</span> Studying Crab Claws (crabs)</a></li>
<li><a class="" href="Hydrate-Study.html"><span class="header-section-number">14</span> Dehydration Recovery</a></li>
<li><a class="" href="WCGS-Study.html"><span class="header-section-number">15</span> The WCGS</a></li>
<li class="book-part">Part B. Comparing Summaries</li>
<li><a class="" href="confidence-intervals-for-a-mean.html"><span class="header-section-number">16</span> Confidence Intervals for a Mean</a></li>
<li><a class="" href="the-ibuprofen-in-sepsis-randomized-clinical-trial.html"><span class="header-section-number">17</span> The Ibuprofen in Sepsis Randomized Clinical Trial</a></li>
<li><a class="" href="comparing-means-with-paired-samples.html"><span class="header-section-number">18</span> Comparing Means with Paired Samples</a></li>
<li><a class="" href="hypothesis-testing-what-is-it-good-for.html"><span class="header-section-number">19</span> Hypothesis Testing: What is it good for?</a></li>
<li><a class="" href="two-examples-comparing-means.html"><span class="header-section-number">20</span> Two Examples Comparing Means</a></li>
<li><a class="" href="estimating-a-population-proportion.html"><span class="header-section-number">21</span> Estimating a Population Proportion</a></li>
<li><a class="" href="comparing-proportions-with-two-independent-samples.html"><span class="header-section-number">22</span> Comparing Proportions with Two Independent Samples</a></li>
<li><a class="" href="power-and-proportions.html"><span class="header-section-number">23</span> Power and Proportions</a></li>
<li><a class="" href="larger-contingency-tables.html"><span class="header-section-number">24</span> Larger Contingency Tables</a></li>
<li><a class="" href="analysis-of-variance.html"><span class="header-section-number">25</span> Analysis of Variance</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="some-r-tips.html">Some R Tips</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/THOMASELOVE/431-notes">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="straight-line-models" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Straight Line Models<a class="anchor" aria-label="anchor" href="#straight-line-models"><i class="fas fa-link"></i></a>
</h1>
<div id="assessing-a-scatterplot" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> Assessing A Scatterplot<a class="anchor" aria-label="anchor" href="#assessing-a-scatterplot"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s consider the relationship of <code>protein</code> and <code>fat</code> consumption for children in the <code>nnyfs</code> data.</p>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnyfs</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="st">"data/nnyfs.Rds"</span><span class="op">)</span></code></pre></div>
<p>We’ll begin our investigation, as we always should, by drawing a relevant picture. For the association of two quantitative variables, a <strong>scatterplot</strong> is usually the right start. Each subject in the <code>nnyfs</code> data is represented by one of the points below. To the plot, I’ve also used <code>geom_smooth</code> to add a straight line regression model, which we’ll discuss later.</p>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nnyfs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">protein</span>, y <span class="op">=</span> <span class="va">fat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"sienna"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Protein vs. Fat consumption"</span>,
         subtitle <span class="op">=</span> <span class="st">"Children in the NNYFS data, with fitted straight line regression model"</span>,
         x <span class="op">=</span> <span class="st">"Protein (in g)"</span>, y <span class="op">=</span> <span class="st">"Fat (in g)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_fig1-1.png" width="672"></div>
<p>Here, I’ve arbitrarily decided to place <code>fat</code> on the vertical axis, and <code>protein</code> on the horizontal. Fitting a prediction model to this scatterplot will then require that we predict <code>fat</code> on the basis of <code>protein</code>.</p>
<p>In this case, the pattern appears to be:</p>
<ol style="list-style-type: decimal">
<li>
<strong>direct</strong>, or positive, in that the values of the <span class="math inline">\(x\)</span> variable (<code>protein</code>) increase, so do the values of the <span class="math inline">\(y\)</span> variable (<code>fat</code>). Essentially, it appears that subjects who consumed more protein also consumed more fat, but we don’t know cause and effect here.</li>
<li>fairly <strong>linear</strong> in that most of the points cluster around what appears to be a pattern which is well-fitted by a straight line.</li>
<li>moderately <strong>strong</strong> in that the range of values for <code>fat</code> associated with any particular value of <code>protein</code> is fairly tight. If we know someone’s protein consumption, that should meaningfully improve our ability to predict their fat consumption, among the subjects in these data.</li>
<li>that we see some unusual or <strong>outlier</strong> values, further away from the general pattern of most subjects shown in the data.</li>
</ol>
<div id="highlighting-an-unusual-point" class="section level3" number="11.1.1">
<h3>
<span class="header-section-number">11.1.1</span> Highlighting an unusual point<a class="anchor" aria-label="anchor" href="#highlighting-an-unusual-point"><i class="fas fa-link"></i></a>
</h3>
<p>Consider the subject with protein consumption close to 200 g, whose fat consumption is below 100 g. That’s well below the prediction of the linear model for example. We can identify the subject because it is the only person with <code>protein</code> &gt; 190 and <code>fat</code> &lt; 100 with BMI &gt; 35 and waist.circ &lt; 70. So I’ll create a subset of the <code>nnyfs</code> data containing the point that meets that standard, and then add a red point and a label to the plot.</p>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># identify outlier and place it in data frame s1 </span>
<span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">nnyfs</span>, <span class="va">protein</span> <span class="op">&gt;</span> <span class="fl">190</span> <span class="op">&amp;</span> <span class="va">fat</span> <span class="op">&lt;</span> <span class="fl">100</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nnyfs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">protein</span>, y <span class="op">=</span> <span class="va">fat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"sienna"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">s1</span>, size <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">s1</span>, label <span class="op">=</span> <span class="va">s1</span><span class="op">$</span><span class="va">SEQN</span>, 
              vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Protein vs. Fat consumption in NNYFS"</span>,
         subtitle <span class="op">=</span> <span class="st">"with regression line, and an outlier labeled by SEQN"</span>,
         x <span class="op">=</span> <span class="st">"Protein (in g)"</span>, y <span class="op">=</span> <span class="st">"Fat (in g)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_fig2-1.png" width="672"></div>
<p>While this subject is hardly the only unusual point in the data set, it is one of the more unusual ones, in terms of its vertical distance from the regression line. We can identify the subject by printing (part of) the tibble we created.</p>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s1</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SEQN</span>, <span class="va">sex</span>, <span class="va">race_eth</span>, <span class="va">age_child</span>, <span class="va">protein</span>, <span class="va">fat</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">SEQN</th>
<th align="left">sex</th>
<th align="left">race_eth</th>
<th align="right">age_child</th>
<th align="right">protein</th>
<th align="right">fat</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">71919</td>
<td align="left">Female</td>
<td align="left">2_White Non-Hispanic</td>
<td align="right">14</td>
<td align="right">199.33</td>
<td align="right">86.08</td>
</tr></tbody>
</table></div>
<p>Now, does it seem to you like a straight line model will describe this <code>protein</code>-<code>fat</code> relationship well?</p>
</div>
<div id="adding-a-scatterplot-smooth-using-loess" class="section level3" number="11.1.2">
<h3>
<span class="header-section-number">11.1.2</span> Adding a Scatterplot Smooth using loess<a class="anchor" aria-label="anchor" href="#adding-a-scatterplot-smooth-using-loess"><i class="fas fa-link"></i></a>
</h3>
<p>Next, we’ll use the <strong>loess</strong> procedure to fit a smooth curve to the data, which attempts to capture the general pattern.</p>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nnyfs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">protein</span>, y <span class="op">=</span> <span class="va">fat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"sienna"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Protein vs. Fat consumption in NNYFS"</span>,
         subtitle <span class="op">=</span> <span class="st">"with loess smooth (red) and linear fit (blue)"</span>,
         x <span class="op">=</span> <span class="st">"Protein (in g)"</span>, y <span class="op">=</span> <span class="st">"Fat (in g)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_fig3-1.png" width="672"></div>
<p>This “loess” smooth curve is fairly close to the straight line fit, indicating that perhaps a linear regression model might fit the data well.</p>
<p>A <strong>loess smooth</strong> is a method of fitting a local polynomial regression model that R uses as its default smooth for scatterplots with fewer than 1000 observations. Think of the loess as a way of fitting a curve to data by tracking (at point x) the points within a neighborhood of point x, with more emphasis given to points near x. It can be adjusted by tweaking two specific parameters, in particular:</p>
<ul>
<li>a <code>span</code> parameter (defaults to 0.75) which is also called <span class="math inline">\(\alpha\)</span> in the literature, that controls the degree of smoothing (essentially, how large the neighborhood should be), and</li>
<li>a <code>degree</code> parameter (defaults to 2) which specifies the degree of polynomial to be used. Normally, this is either 1 or 2 - more complex functions are rarely needed for simple scatterplot smoothing.</li>
</ul>
<p>In addition to the curve, smoothing procedures can also provide confidence intervals around their main fitted line. Consider the following plot, which adjusts the span and also adds in the confidence intervals.</p>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nnyfs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">protein</span>, y <span class="op">=</span> <span class="va">fat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"sienna"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">0.75</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, 
                col <span class="op">=</span> <span class="st">"red"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"loess smooth (span = 0.75)"</span>,
         x <span class="op">=</span> <span class="st">"Protein (in g)"</span>, y <span class="op">=</span> <span class="st">"Fat (in g)"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nnyfs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">protein</span>, y <span class="op">=</span> <span class="va">fat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"sienna"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">0.2</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, 
                col <span class="op">=</span> <span class="st">"red"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"loess smooth (span = 0.2)"</span>,
         x <span class="op">=</span> <span class="st">"Protein (in g)"</span>, y <span class="op">=</span> <span class="st">"Fat (in g)"</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> 
    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Impact of adjusting loess smooth span: NNYFS"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_fig4-1.png" width="672"></div>
<p>By reducing the size of the span, the plot on the right shows a somewhat less “smooth” function than the plot on the left.</p>
</div>
<div id="what-line-does-r-fit" class="section level3" number="11.1.3">
<h3>
<span class="header-section-number">11.1.3</span> What Line Does R Fit?<a class="anchor" aria-label="anchor" href="#what-line-does-r-fit"><i class="fas fa-link"></i></a>
</h3>
<p>Returning to the linear regression model, how can we, mathematically, characterize that line? As with any straight line, our model equation requires us to specify two parameters: a slope and an intercept (sometimes called the y-intercept.)</p>
<p>To identify the equation R used to fit this line (using the method of least squares), we use the <code>lm</code> command</p>
<div class="sourceCode" id="cb370"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fat</span> <span class="op">~</span> <span class="va">protein</span>, data <span class="op">=</span> <span class="va">nnyfs</span><span class="op">)</span></code></pre></div>
<pre><code>
Call:
lm(formula = fat ~ protein, data = nnyfs)

Coefficients:
(Intercept)      protein  
    18.8945       0.7251  </code></pre>
<p>So the fitted line is specified as</p>
<p><span class="math display">\[
\mbox{fat} = 18.8945 + 0.7251 \mbox{ protein }
\]</span></p>
<p>A detailed summary of the fitted linear regression model is also available.</p>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fat</span> <span class="op">~</span> <span class="va">protein</span>, data <span class="op">=</span> <span class="va">nnyfs</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>
Call:
lm(formula = fat ~ protein, data = nnyfs)

Residuals:
    Min      1Q  Median      3Q     Max 
-77.798 -14.841  -2.449  13.601 110.597 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  18.8945     1.5330   12.32   &lt;2e-16 ***
protein       0.7251     0.0208   34.87   &lt;2e-16 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 25.08 on 1516 degrees of freedom
Multiple R-squared:  0.4451,    Adjusted R-squared:  0.4447 
F-statistic:  1216 on 1 and 1516 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The way we’ll usually summarize the estimated coefficients of a linear model is to use the <code>broom</code> package’s <code>tidy</code> function to put the coefficient estimates into a tibble.</p>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fat</span> <span class="op">~</span> <span class="va">protein</span>, data <span class="op">=</span> <span class="va">nnyfs</span><span class="op">)</span>,
            conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">18.895</td>
<td align="right">1.533</td>
<td align="right">12.325</td>
<td align="right">0</td>
<td align="right">15.887</td>
<td align="right">21.902</td>
</tr>
<tr class="even">
<td align="left">protein</td>
<td align="right">0.725</td>
<td align="right">0.021</td>
<td align="right">34.868</td>
<td align="right">0</td>
<td align="right">0.684</td>
<td align="right">0.766</td>
</tr>
</tbody>
</table></div>
<p>We can also summarize the quality of fit in a linear model using the <code>broom</code> package’s <code>glance</code> function. For now, we’ll focus our attention on just one of the many summaries available for a linear model from <code>glance</code>: the R-squared value.</p>
<div class="sourceCode" id="cb375"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">fat</span> <span class="op">~</span> <span class="va">protein</span>, data <span class="op">=</span> <span class="va">nnyfs</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">r.squared</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">r.squared</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0.445</td>
</tr></tbody>
</table></div>
<p>We’ll spend a lot of time working with these regression summaries in this course.</p>
<p>For now, it will suffice to understand the following:</p>
<ul>
<li>The outcome variable in this model is <strong>fat</strong>, and the predictor variable is <strong>protein</strong>.</li>
<li>The straight line model for these data fitted by least squares is <code>fat</code> = 18.9 + 0.725 <code>protein</code>
</li>
<li>The slope of <code>protein</code> is positive, which indicates that as <code>protein</code> increases, we expect that <code>fat</code> will also increase. Specifically, we expect that for every additional gram of protein consumed, the fat consumption will be 0.725 gram larger.</li>
<li>The multiple R-squared (squared correlation coefficient) is 0.445, which implies that 44.5% of the variation in <code>fat</code> is explained using this linear model with <code>protein</code>.</li>
<li>This also implies that the Pearson correlation between <code>fat</code> and <code>protein</code> is the square root of 0.445, or 0.667. More on the Pearson correlation soon.</li>
</ul>
<p>So, if we plan to use a simple (least squares) linear regression model to describe fat consumption as a function of protein consumption in the NNYFS data, does it look like a least squares (or linear regression) model will be an effective choice?</p>
</div>
</div>
<div id="correlation-coefficients" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> Correlation Coefficients<a class="anchor" aria-label="anchor" href="#correlation-coefficients"><i class="fas fa-link"></i></a>
</h2>
<p>Two different correlation measures are worth our immediate attention.</p>
<ul>
<li>The one most often used is called the <em>Pearson</em> correlation coefficient, and is symbolized with the letter r or sometimes the Greek letter rho (<span class="math inline">\(\rho\)</span>).</li>
<li>Another tool is the Spearman rank correlation coefficient, also occasionally symbolized by <span class="math inline">\(\rho\)</span>.</li>
</ul>
<p>For the <code>nnyfs</code> data, the Pearson correlation of <code>fat</code> and <code>protein</code> can be found using the <code><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor()</a></code> function.</p>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnyfs</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">fat</span>, <span class="va">protein</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 0.6671209</code></pre>
<p>Note that the correlation of any variable with itself is 1, and that the correlation of <code>fat</code> with <code>protein</code> is the same regardless of whether you enter <code>fat</code> first or <code>protein</code> first.</p>
</div>
<div id="the-pearson-correlation-coefficient" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> The Pearson Correlation Coefficient<a class="anchor" aria-label="anchor" href="#the-pearson-correlation-coefficient"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose we have <span class="math inline">\(n\)</span> observations on two variables, called X and Y. The Pearson correlation coefficient assesses how well the relationship between X and Y can be described using a linear function.</p>
<ul>
<li>The Pearson correlation is <strong>dimension-free</strong>.</li>
<li>It falls between -1 and +1, with the extremes corresponding to situations where all the points in a scatterplot fall exactly on a straight line with negative and positive slopes, respectively.</li>
<li>A Pearson correlation of zero corresponds to the situation where there is no linear association.</li>
<li>Unlike the estimated slope in a regression line, the sample correlation coefficient is symmetric in X and Y, so it does not depend on labeling one of them (Y) the response variable, and one of them (X) the predictor.</li>
</ul>
<p>Suppose we have <span class="math inline">\(n\)</span> observations on two variables, called <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, where <span class="math inline">\(\bar{X}\)</span> is the sample mean of <span class="math inline">\(X\)</span> and <span class="math inline">\(s_x\)</span> is the standard deviation of <span class="math inline">\(X\)</span>. The <strong>Pearson</strong> correlation coefficient <span class="math inline">\(r_{XY}\)</span> is:</p>
<p><span class="math display">\[
r_{XY} = \frac{1}{n-1} \sum\limits_{i=1}^n (\frac{x_i - \bar{x}}{s_x}) (\frac{y_i - \bar{y}}{s_y}) 
\]</span></p>
</div>
<div id="studying-correlation-through-6-examples" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Studying Correlation through 6 Examples<a class="anchor" aria-label="anchor" href="#studying-correlation-through-6-examples"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>correx1</code> data file contains six different sets of (x,y) points, identified by the <code>set</code> variable.</p>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">correx1</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/correx1.csv"</span><span class="op">)</span> </code></pre></div>
<pre><code>Rows: 277 Columns: 3</code></pre>
<pre><code>-- Column specification ------------------------------------
Delimiter: ","
chr (1): set
dbl (2): x, y</code></pre>
<pre><code>
i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">correx1</span><span class="op">)</span></code></pre></div>
<pre><code>     set                  x                y         
 Length:277         Min.   : 5.897   Min.   : 7.308  
 Class :character   1st Qu.:29.487   1st Qu.:30.385  
 Mode  :character   Median :46.154   Median :46.923  
                    Mean   :46.529   Mean   :49.061  
                    3rd Qu.:63.333   3rd Qu.:68.077  
                    Max.   :98.205   Max.   :95.385  </code></pre>
<div id="data-set-alex" class="section level3" number="11.4.1">
<h3>
<span class="header-section-number">11.4.1</span> Data Set Alex<a class="anchor" aria-label="anchor" href="#data-set-alex"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s start by working with the <strong>Alex</strong> data set.</p>
<div class="sourceCode" id="cb384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">correx1</span>, <span class="va">set</span> <span class="op">==</span> <span class="st">"Alex"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"correx1: Data Set Alex"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig1-1.png" width="672"></div>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">correx1</span>, <span class="va">set</span> <span class="op">==</span> <span class="st">"Alex"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"correx1: Alex, with loess smooth"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig2-1.png" width="672"></div>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">setA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">correx1</span>, <span class="va">set</span> <span class="op">==</span> <span class="st">"Alex"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">setA</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"correx1: Alex, with Fitted Linear Model"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">75</span>, y <span class="op">=</span> <span class="fl">75</span>, col <span class="op">=</span> <span class="st">"purple"</span>, size <span class="op">=</span> <span class="fl">6</span>,
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Pearson r = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">setA</span><span class="op">$</span><span class="va">x</span>, <span class="va">setA</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">50</span>, y <span class="op">=</span> <span class="fl">15</span>,  col <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">5</span>,
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"y = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">setA</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">setA</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">3</span><span class="op">)</span>, 
                           <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">setA</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">setA</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"x"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig3-1.png" width="672"></div>
</div>
<div id="data-set-bonnie" class="section level3" number="11.4.2">
<h3>
<span class="header-section-number">11.4.2</span> Data Set Bonnie<a class="anchor" aria-label="anchor" href="#data-set-bonnie"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">setB</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">correx1</span>, <span class="va">set</span> <span class="op">==</span> <span class="st">"Bonnie"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">setB</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"correx1: Data Set Bonnie"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig4-1.png" width="672"></div>
<div class="sourceCode" id="cb388"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">setB</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"correx1: Bonnie, with Fitted Linear Model"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">25</span>, y <span class="op">=</span> <span class="fl">65</span>, col <span class="op">=</span> <span class="st">"purple"</span>, size <span class="op">=</span> <span class="fl">6</span>,
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Pearson r = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">setB</span><span class="op">$</span><span class="va">x</span>, <span class="va">setB</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">50</span>, y <span class="op">=</span> <span class="fl">15</span>,  col <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">5</span>,
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"y = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">setB</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">setB</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">3</span><span class="op">)</span>, 
                           <span class="st">" + "</span>,
                           <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">setB</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">setB</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fl">2</span><span class="op">)</span>, <span class="st">"x"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig5-1.png" width="672"></div>
</div>
<div id="correlations-for-all-six-data-sets-in-the-correx1-example" class="section level3" number="11.4.3">
<h3>
<span class="header-section-number">11.4.3</span> Correlations for All Six Data Sets in the Correx1 Example<a class="anchor" aria-label="anchor" href="#correlations-for-all-six-data-sets-in-the-correx1-example"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s look at the Pearson correlations associated with each of the six data sets contained in the <code>correx1</code> example.</p>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tab1</span> <span class="op">&lt;-</span> <span class="va">correx1</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">set</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="st">"Pearson r"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, use<span class="op">=</span><span class="st">"complete"</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">tab1</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">set</th>
<th align="right">Pearson r</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alex</td>
<td align="right">-0.97</td>
</tr>
<tr class="even">
<td align="left">Bonnie</td>
<td align="right">0.80</td>
</tr>
<tr class="odd">
<td align="left">Colin</td>
<td align="right">-0.80</td>
</tr>
<tr class="even">
<td align="left">Danielle</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">Earl</td>
<td align="right">-0.01</td>
</tr>
<tr class="even">
<td align="left">Fiona</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table></div>
</div>
<div id="data-set-colin" class="section level3" number="11.4.4">
<h3>
<span class="header-section-number">11.4.4</span> Data Set Colin<a class="anchor" aria-label="anchor" href="#data-set-colin"><i class="fas fa-link"></i></a>
</h3>
<p>It looks like the picture for Colin should be very similar (in terms of scatter) to the picture for Bonnie, except that Colin will have a negative slope, rather than the positive one Bonnie has. Is that how this plays out?</p>
<div class="sourceCode" id="cb390"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">setBC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">correx1</span>, <span class="va">set</span> <span class="op">==</span> <span class="st">"Bonnie"</span> <span class="op">|</span> <span class="va">set</span> <span class="op">==</span> <span class="st">"Colin"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">setBC</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">set</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig7-1.png" width="672"></div>
<p>Uh, oh. It looks like the point in Colin at the top right is twisting what would otherwise be a very straight regression model with an extremely strong negative correlation. There’s no better way to look for outliers than to examine the scatterplot.</p>
</div>
<div id="draw-the-picture" class="section level3" number="11.4.5">
<h3>
<span class="header-section-number">11.4.5</span> Draw the Picture!<a class="anchor" aria-label="anchor" href="#draw-the-picture"><i class="fas fa-link"></i></a>
</h3>
<p>We’ve seen that Danielle, Earl and Fiona all show Pearson correlations of essentially zero. However, the three data sets look very different in a scatterplot.</p>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">correx1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">set</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig8-1.png" width="672"></div>
<p>When we learn that the correlation is zero, we tend to assume we have a picture like the Danielle data set. If Danielle were our real data, we might well think that x would be of little use in predicting y.</p>
<ul>
<li>But what if our data looked like Earl? In the Earl data set, x is incredibly helpful in predicting y, but we can’t use a straight line model - instead, we need a non-linear modeling approach.</li>
<li>You’ll recall that the Fiona data set also had a Pearson correlation of zero. But here, the picture is rather more interesting.</li>
</ul>
<p>So, remember, draw the appropriate scatterplot whenever you make use of a correlation coefficient.</p>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">setA</span>, <span class="va">setB</span>, <span class="va">setBC</span>, <span class="va">tab1</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="estimating-correlation-from-scatterplots" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Estimating Correlation from Scatterplots<a class="anchor" aria-label="anchor" href="#estimating-correlation-from-scatterplots"><i class="fas fa-link"></i></a>
</h2>
<p>The correx2 data set is designed to help you calibrate yourself a bit in terms of estimating a correlation from a scatterplot. There are 11 data sets buried within the correx2 example, and they are labeled by their Pearson correlation coefficients, ranging from r = 0.01 to r = 0.999</p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">correx2</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/correx2.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>Rows: 582 Columns: 4</code></pre>
<pre><code>-- Column specification ------------------------------------
Delimiter: ","
chr (1): set
dbl (3): x, y, group</code></pre>
<pre><code>
i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">correx2</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">set</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>cor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, use<span class="op">=</span><span class="st">"complete"</span><span class="op">)</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 11 x 2
   set       cor
   &lt;chr&gt;   &lt;dbl&gt;
 1 Set 01  0.01 
 2 Set 10  0.102
 3 Set 20  0.202
 4 Set 30  0.301
 5 Set 40  0.403
 6 Set 50  0.499
 7 Set 60  0.603
 8 Set 70  0.702
 9 Set 80  0.799
10 Set 90  0.902
11 Set 999 0.999</code></pre>
<p>Here is a plot of the 11 data sets, showing the increase in correlation from 0.01 (in Set 01) to 0.999 (in Set 999).</p>
<div class="sourceCode" id="cb399"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">correx2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">set</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Pearson Correlations from 0.01 to 0.999"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig10-1.png" width="672"></div>
<p>Note that R will allow you to fit a straight line model to any of these relationships, no matter how appropriate it might be to do so.</p>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">correx2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">set</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"R will fit a straight line to anything."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig11-1.png" width="672"></div>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">correx2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">set</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Even if a loess smooth suggests non-linearity."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig12-1.png" width="672"></div>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">correx2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">set</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Note: The same 10 points (in red) are in each plot."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_correxfig13-1.png" width="672"></div>
<p>Note that the same 10 points are used in each of the data sets. It’s always possible that a lurking subgroup of the data within a scatterplot follows a very strong linear relationship. This is why it’s so important (and difficult) not to go searching for such a thing without a strong foundation of logic, theory and prior empirical evidence.</p>
</div>
<div id="the-spearman-rank-correlation" class="section level2" number="11.6">
<h2>
<span class="header-section-number">11.6</span> The Spearman Rank Correlation<a class="anchor" aria-label="anchor" href="#the-spearman-rank-correlation"><i class="fas fa-link"></i></a>
</h2>
<p>The Spearman rank correlation coefficient is a rank-based measure of statistical dependence that assesses how well the relationship between X and Y can be described using a <strong>monotone function</strong> even if that relationship is not linear.</p>
<ul>
<li>A monotone function preserves order, that is, Y must either be strictly increasing as X increases, or strictly decreasing as X increases.</li>
<li>A Spearman correlation of 1.0 indicates simply that as X increases, Y always increases.</li>
<li>Like the Pearson correlation, the Spearman correlation is dimension-free, and falls between -1 and +1.</li>
<li>A positive Spearman correlation corresponds to an increasing (but not necessarily linear) association between X and Y, while a negative Spearman correlation corresponds to a decreasing (but again not necessarily linear) association.</li>
</ul>
<div id="spearman-formula" class="section level3" number="11.6.1">
<h3>
<span class="header-section-number">11.6.1</span> Spearman Formula<a class="anchor" aria-label="anchor" href="#spearman-formula"><i class="fas fa-link"></i></a>
</h3>
<p>To calculate the Spearman rank correlation, we take the ranks of the X and Y data, and then apply the usual Pearson correlation. To find the ranks, sort X and Y into ascending order, and then number them from 1 (smallest) to n (largest). In the event of a tie, assign the average rank to the tied subjects.</p>
</div>
<div id="comparing-pearson-and-spearman-correlations" class="section level3" number="11.6.2">
<h3>
<span class="header-section-number">11.6.2</span> Comparing Pearson and Spearman Correlations<a class="anchor" aria-label="anchor" href="#comparing-pearson-and-spearman-correlations"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s look at the <code>nnyfs</code> data again.</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnyfs</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">fat</span>, <span class="va">protein</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 0.6671209</code></pre>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnyfs</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">fat</span>, <span class="va">protein</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 0.6577489</code></pre>
<p>The Spearman and Pearson correlations are not especially different in this case.</p>
</div>
<div id="spearman-vs.-pearson-example-1" class="section level3" number="11.6.3">
<h3>
<span class="header-section-number">11.6.3</span> Spearman vs. Pearson Example 1<a class="anchor" aria-label="anchor" href="#spearman-vs.-pearson-example-1"><i class="fas fa-link"></i></a>
</h3>
<p>The next few plots describe relationships where we anticipate the Pearson and Spearman correlations might differ in their conclusions.</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spear1</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/spear1.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>Rows: 22 Columns: 2</code></pre>
<pre><code>-- Column specification ------------------------------------
Delimiter: ","
dbl (2): x, y</code></pre>
<pre><code>
i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spear2</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/spear2.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>Rows: 90 Columns: 2</code></pre>
<pre><code>-- Column specification ------------------------------------
Delimiter: ","
dbl (2): x, y</code></pre>
<pre><code>
i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spear3</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/spear3.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>Rows: 55 Columns: 2</code></pre>
<pre><code>-- Column specification ------------------------------------
Delimiter: ","
dbl (2): x, y</code></pre>
<pre><code>
i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spear4</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/spear4.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>Rows: 15 Columns: 2</code></pre>
<pre><code>-- Column specification ------------------------------------
Delimiter: ","
dbl (2): x, y</code></pre>
<pre><code>
i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># these are just toy examples with</span>
<span class="co"># two columns per data set and no row numbering</span></code></pre></div>
<p>Example 1 shows a function where the Pearson correlation is 0.925 (a strong but not perfect linear relation), but the Spearman correlation is 1 because the relationship is monotone, even though it is not perfectly linear.</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">spear1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Spearman vs. Pearson, Example 1"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, y <span class="op">=</span> <span class="fl">20</span>, 
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Pearson r = "</span>, 
                 <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">spear1</span><span class="op">$</span><span class="va">x</span>, <span class="va">spear1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,
                 <span class="st">", Spearman r = "</span>, 
                 <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">spear1</span><span class="op">$</span><span class="va">x</span>, <span class="va">spear1</span><span class="op">$</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_nnyfs_spear2-1.png" width="672"></div>
<p>So, a positive Spearman correlation corresponds to an increasing (but not necessarily linear) association between x and y.</p>
</div>
<div id="spearman-vs.-pearson-example-2" class="section level3" number="11.6.4">
<h3>
<span class="header-section-number">11.6.4</span> Spearman vs. Pearson Example 2<a class="anchor" aria-label="anchor" href="#spearman-vs.-pearson-example-2"><i class="fas fa-link"></i></a>
</h3>
<p>Example 2 shows that a negative Spearman correlation corresponds to a decreasing (but, again, not necessarily linear) association between x and y.</p>
<div class="sourceCode" id="cb425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">spear2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Spearman vs. Pearson, Example 2"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"purple"</span>,
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Pearson r = "</span>, 
                    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">spear2</span><span class="op">$</span><span class="va">x</span>, <span class="va">spear2</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,
                    <span class="st">", Spearman r = "</span>, 
                    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">spear2</span><span class="op">$</span><span class="va">x</span>, <span class="va">spear2</span><span class="op">$</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_nnyfs_spear3-1.png" width="672"></div>
</div>
<div id="spearman-vs.-pearson-example-3" class="section level3" number="11.6.5">
<h3>
<span class="header-section-number">11.6.5</span> Spearman vs. Pearson Example 3<a class="anchor" aria-label="anchor" href="#spearman-vs.-pearson-example-3"><i class="fas fa-link"></i></a>
</h3>
<p>The Spearman correlation is less sensitive than the Pearson correlation is to strong outliers that are unusual on either the X or Y axis, or both. That is because the Spearman rank coefficient limits the outlier to the value of its rank.</p>
<p>In Example 3, for instance, the Spearman correlation reacts much less to the outliers around X = 12 than does the Pearson correlation.</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">spear3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Spearman vs. Pearson, Example 3"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">5</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">15</span>, col <span class="op">=</span> <span class="st">"blue"</span>,
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Pearson r = "</span>, 
                <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">spear3</span><span class="op">$</span><span class="va">x</span>, <span class="va">spear3</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,
                <span class="st">", Spearman r = "</span>, 
                <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">spear3</span><span class="op">$</span><span class="va">x</span>, <span class="va">spear3</span><span class="op">$</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_nnyfs_spear4-1.png" width="672"></div>
</div>
<div id="spearman-vs.-pearson-example-4" class="section level3" number="11.6.6">
<h3>
<span class="header-section-number">11.6.6</span> Spearman vs. Pearson Example 4<a class="anchor" aria-label="anchor" href="#spearman-vs.-pearson-example-4"><i class="fas fa-link"></i></a>
</h3>
<p>The use of a Spearman correlation is no substitute for looking at the data. For non-monotone data like what we see in Example 4, neither the Spearman nor the Pearson correlation alone provides much guidance, and just because they are (essentially) telling you the same thing, that doesn’t mean what they’re telling you is all that helpful.</p>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">spear4</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Spearman vs. Pearson, Example 4"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"purple"</span>,
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Pearson r = "</span>, 
                 <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">spear4</span><span class="op">$</span><span class="va">x</span>, <span class="va">spear4</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,
                 <span class="st">", Spearman r = "</span>, 
                 <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">spear4</span><span class="op">$</span><span class="va">x</span>, <span class="va">spear4</span><span class="op">$</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="11_straightlinemodels_files/figure-html/c10_nnyfs_spear5-1.png" width="672"></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="assessing-normality.html"><span class="header-section-number">10</span> Assessing Normality</a></div>
<div class="next"><a href="linearizing-transformations.html"><span class="header-section-number">12</span> Linearizing Transformations</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#straight-line-models"><span class="header-section-number">11</span> Straight Line Models</a></li>
<li>
<a class="nav-link" href="#assessing-a-scatterplot"><span class="header-section-number">11.1</span> Assessing A Scatterplot</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#highlighting-an-unusual-point"><span class="header-section-number">11.1.1</span> Highlighting an unusual point</a></li>
<li><a class="nav-link" href="#adding-a-scatterplot-smooth-using-loess"><span class="header-section-number">11.1.2</span> Adding a Scatterplot Smooth using loess</a></li>
<li><a class="nav-link" href="#what-line-does-r-fit"><span class="header-section-number">11.1.3</span> What Line Does R Fit?</a></li>
</ul>
</li>
<li><a class="nav-link" href="#correlation-coefficients"><span class="header-section-number">11.2</span> Correlation Coefficients</a></li>
<li><a class="nav-link" href="#the-pearson-correlation-coefficient"><span class="header-section-number">11.3</span> The Pearson Correlation Coefficient</a></li>
<li>
<a class="nav-link" href="#studying-correlation-through-6-examples"><span class="header-section-number">11.4</span> Studying Correlation through 6 Examples</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-set-alex"><span class="header-section-number">11.4.1</span> Data Set Alex</a></li>
<li><a class="nav-link" href="#data-set-bonnie"><span class="header-section-number">11.4.2</span> Data Set Bonnie</a></li>
<li><a class="nav-link" href="#correlations-for-all-six-data-sets-in-the-correx1-example"><span class="header-section-number">11.4.3</span> Correlations for All Six Data Sets in the Correx1 Example</a></li>
<li><a class="nav-link" href="#data-set-colin"><span class="header-section-number">11.4.4</span> Data Set Colin</a></li>
<li><a class="nav-link" href="#draw-the-picture"><span class="header-section-number">11.4.5</span> Draw the Picture!</a></li>
</ul>
</li>
<li><a class="nav-link" href="#estimating-correlation-from-scatterplots"><span class="header-section-number">11.5</span> Estimating Correlation from Scatterplots</a></li>
<li>
<a class="nav-link" href="#the-spearman-rank-correlation"><span class="header-section-number">11.6</span> The Spearman Rank Correlation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#spearman-formula"><span class="header-section-number">11.6.1</span> Spearman Formula</a></li>
<li><a class="nav-link" href="#comparing-pearson-and-spearman-correlations"><span class="header-section-number">11.6.2</span> Comparing Pearson and Spearman Correlations</a></li>
<li><a class="nav-link" href="#spearman-vs.-pearson-example-1"><span class="header-section-number">11.6.3</span> Spearman vs. Pearson Example 1</a></li>
<li><a class="nav-link" href="#spearman-vs.-pearson-example-2"><span class="header-section-number">11.6.4</span> Spearman vs. Pearson Example 2</a></li>
<li><a class="nav-link" href="#spearman-vs.-pearson-example-3"><span class="header-section-number">11.6.5</span> Spearman vs. Pearson Example 3</a></li>
<li><a class="nav-link" href="#spearman-vs.-pearson-example-4"><span class="header-section-number">11.6.6</span> Spearman vs. Pearson Example 4</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/THOMASELOVE/431-notes/blob/master/11_straightlinemodels.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/THOMASELOVE/431-notes/edit/master/11_straightlinemodels.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</strong>" was written by Thomas E. Love. It was last built on 2021-10-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
