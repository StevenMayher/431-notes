<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 Linearizing Transformations | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</title>
<meta name="author" content="Thomas E. Love">
<meta name="description" content="12.1 “Linearize” The Association between Quantitative Variables Confronted with a scatterplot describing a monotone association between two quantitative variables, we may decide the data are not...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 12 Linearizing Transformations | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta property="og:type" content="book">
<meta property="og:url" content="your book url like https://thomaselove.github.io/431-book/linearizing-transformations.html">
<meta property="og:description" content="12.1 “Linearize” The Association between Quantitative Variables Confronted with a scatterplot describing a monotone association between two quantitative variables, we may decide the data are not...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 Linearizing Transformations | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta name="twitter:description" content="12.1 “Linearize” The Association between Quantitative Variables Confronted with a scatterplot describing a monotone association between two quantitative variables, we may decide the data are not...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Working with These Notes</a></li>
<li><a class="" href="data-science.html"><span class="header-section-number">1</span> Data Science</a></li>
<li class="book-part">Part A. Exploring Data</li>
<li><a class="" href="the-palmer-penguins.html"><span class="header-section-number">2</span> The Palmer Penguins</a></li>
<li><a class="" href="nhanes1.html"><span class="header-section-number">3</span> NHANES: A First Look</a></li>
<li><a class="" href="data-structures-variable-types-sampling-nhanes.html"><span class="header-section-number">4</span> Data Structures, Variable Types &amp; Sampling NHANES</a></li>
<li><a class="" href="visualizing-nhanes-data.html"><span class="header-section-number">5</span> Visualizing NHANES Data</a></li>
<li><a class="" href="summarizing_quantities.html"><span class="header-section-number">6</span> Summarizing Quantities</a></li>
<li><a class="" href="summarizing-categories.html"><span class="header-section-number">7</span> Summarizing Categories</a></li>
<li><a class="" href="miss.html"><span class="header-section-number">8</span> Missing Data and Single Imputation</a></li>
<li><a class="" href="NYFS-Study.html"><span class="header-section-number">9</span> National Youth Fitness Survey</a></li>
<li><a class="" href="assessing-normality.html"><span class="header-section-number">10</span> Assessing Normality</a></li>
<li><a class="" href="straight-line-models.html"><span class="header-section-number">11</span> Straight Line Models</a></li>
<li><a class="active" href="linearizing-transformations.html"><span class="header-section-number">12</span> Linearizing Transformations</a></li>
<li><a class="" href="studying-crab-claws-crabs.html"><span class="header-section-number">13</span> Studying Crab Claws (crabs)</a></li>
<li><a class="" href="Hydrate-Study.html"><span class="header-section-number">14</span> Dehydration Recovery</a></li>
<li><a class="" href="WCGS-Study.html"><span class="header-section-number">15</span> The WCGS</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="some-r-tips.html">Some R Tips</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/THOMASELOVE/431-notes">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="linearizing-transformations" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Linearizing Transformations<a class="anchor" aria-label="anchor" href="#linearizing-transformations"><i class="fas fa-link"></i></a>
</h1>
<div id="linearize-the-association-between-quantitative-variables" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> “Linearize” The Association between Quantitative Variables<a class="anchor" aria-label="anchor" href="#linearize-the-association-between-quantitative-variables"><i class="fas fa-link"></i></a>
</h2>
<p>Confronted with a scatterplot describing a monotone association between two quantitative variables, we may decide the data are not well approximated by a straight line, and thus, that a least squares regression may not be not sufficiently useful. In these circumstances, we have at least two options, which are not mutually exclusive:</p>
<ol style="list-style-type: lower-alpha">
<li>Let the data be as they may, and summarize the scatterplot using tools like loess curves, polynomial functions, or cubic splines to model the relationship.</li>
<li>Consider re-expressing the data (often we start with re-expressions of the outcome data [the Y variable]) using a transformation so that the transformed data may be modeled effectively using a straight line.</li>
</ol>
</div>
<div id="the-box-cox-plot" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> The Box-Cox Plot<a class="anchor" aria-label="anchor" href="#the-box-cox-plot"><i class="fas fa-link"></i></a>
</h2>
<p>As before, Tukey’s ladder of power transformations can guide our exploration.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Power (<span class="math inline">\(\lambda\)</span>)</th>
<th align="center">-2</th>
<th align="center">-1</th>
<th align="center">-1/2</th>
<th align="center">0</th>
<th align="center">1/2</th>
<th align="center">1</th>
<th align="center">2</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">Transformation</td>
<td align="center">1/y<sup>2</sup>
</td>
<td align="center">1/y</td>
<td align="center">1/<span class="math inline">\(\sqrt{y}\)</span>
</td>
<td align="center">log y</td>
<td align="center"><span class="math inline">\(\sqrt{y}\)</span></td>
<td align="center">y</td>
<td align="center">y<sup>2</sup>
</td>
</tr></tbody>
</table></div>
<p>The <strong>Box-Cox plot</strong>, from the <code>boxCox</code> function in the <code>car</code> package, sifts through the ladder of options to suggest a transformation (for Y) to best linearize the outcome-predictor(s) relationship.</p>
<div id="a-few-caveats" class="section level3" number="12.2.1">
<h3>
<span class="header-section-number">12.2.1</span> A Few Caveats<a class="anchor" aria-label="anchor" href="#a-few-caveats"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>These methods work well with <em>monotone</em> data, where a smooth function of Y is either strictly increasing, or strictly decreasing, as X increases.</li>
<li>Some of these transformations require the data to be positive. We can rescale the Y data by adding a constant to every observation in a data set without changing shape.</li>
<li>We can use a natural logarithm (<code>log</code> in R), a base 10 logarithm (<code>log10</code>) or even sometimes a base 2 logarithm (<code>log2</code>) to good effect in Tukey’s ladder. All affect the association’s shape in the same way, so we’ll stick with <code>log</code> (base e).</li>
<li>Some re-expressions don’t lead to easily interpretable results. Not many things that make sense in their original units also make sense in inverse square roots. There are times when we won’t care, but often, we will.</li>
<li>If our primary interest is in making predictions, we’ll generally be more interested in getting good predictions back on the original scale, and we can back-transform the point and interval estimates to accomplish this.</li>
</ol>
</div>
</div>
<div id="a-simulated-example" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> A Simulated Example<a class="anchor" aria-label="anchor" href="#a-simulated-example"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">999</span><span class="op">)</span>; <span class="va">x.rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">20</span> <span class="op">+</span> <span class="fl">3</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>; <span class="va">y.rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fl">50</span> <span class="op">+</span> <span class="fl">0.75</span><span class="op">*</span><span class="va">x.rand</span><span class="op">^</span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.65</span><span class="op">*</span><span class="va">x.rand</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span>
<span class="va">scatter1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.rand</span>, y <span class="op">=</span> <span class="va">y.rand</span><span class="op">)</span> </code></pre></div>
<pre><code>Warning: `data_frame()` was deprecated in tibble 1.1.0.
Please use `tibble()` instead.
This warning is displayed once every 8 hours.
Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">x.rand</span>, <span class="va">y.rand</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">scatter1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
    <span class="co">## add loess smooth</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, 
                col <span class="op">=</span> <span class="st">"dodgerblue"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
    <span class="co">## then add linear fit</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, 
                col <span class="op">=</span> <span class="st">"red"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Simulated scatter1 example: Y vs. X"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12_Reexpression_and_BoxCox_files/figure-html/unnamed-chunk-1-1.png" width="480" style="display: block; margin: auto;"></div>
<p>Having simulated data that produces a curved scatterplot, I will now use the Box-Cox plot to lead my choice of an appropriate power transformation for Y in order to “linearize” the association of Y and X.</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/car/man/boxCox.html">boxCox</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="12_Reexpression_and_BoxCox_files/figure-html/unnamed-chunk-2-1.png" width="672"></div>
<div class="sourceCode" id="cb432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/car/man/powerTransform.html">powerTransform</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>Estimated transformation parameter 
       Y1 
0.4368753 </code></pre>
<p>The Box-Cox plot peaks at the value <span class="math inline">\(\lambda\)</span> = 0.44, which is pretty close to <span class="math inline">\(\lambda\)</span> = 0.5. Now, 0.44 isn’t on Tukey’s ladder, but 0.5 is.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Power (<span class="math inline">\(\lambda\)</span>)</th>
<th align="center">-2</th>
<th align="center">-1</th>
<th align="center">-1/2</th>
<th align="center">0</th>
<th align="center">1/2</th>
<th align="center">1</th>
<th align="center">2</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">Transformation</td>
<td align="center">1/y<sup>2</sup>
</td>
<td align="center">1/y</td>
<td align="center">1/<span class="math inline">\(\sqrt{y}\)</span>
</td>
<td align="center">log y</td>
<td align="center"><span class="math inline">\(\sqrt{y}\)</span></td>
<td align="center">y</td>
<td align="center">y<sup>2</sup>
</td>
</tr></tbody>
</table></div>
<p>If we use <span class="math inline">\(\lambda\)</span> = 0.5, on Tukey’s ladder of power transformations, it suggests we look at the relationship between the square root of Y and X, as shown next.</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">scatter1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, 
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"dodgerblue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, 
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"scatter1: Y vs. X"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">scatter1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, 
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"dodgerblue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, 
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"scatter1: Square Root of Y vs. X"</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></code></pre></div>
<div class="inline-figure"><img src="12_Reexpression_and_BoxCox_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<p>By eye, I think the square root plot better matches the linear fit.</p>
</div>
<div id="checking-on-a-transformation-or-re-expression" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Checking on a Transformation or Re-Expression<a class="anchor" aria-label="anchor" href="#checking-on-a-transformation-or-re-expression"><i class="fas fa-link"></i></a>
</h2>
<p>We can do three more things to check on our transformation.</p>
<ol style="list-style-type: decimal">
<li>We can calculate the correlation of our original and re-expressed associations.</li>
<li>We can use the <code>testTransform</code> function in the <code>car</code> library in R to perform a statistical test comparing the optimal choice of power (<span class="math inline">\(\lambda\)</span> = 0.44) to various other transformations.</li>
<li>We can go ahead and fit the regression models using each approach and compare the plots of studentized residuals against fitted values from the data to see if the re-expression reduces the curve in that residual plot, as well.</li>
</ol>
<p>Option 3 is by far the most important in practice, and it’s the one we’ll focus on going forward, but we’ll demonstrate all three here.</p>
<div id="checking-the-correlation-coefficients" class="section level3" number="12.4.1">
<h3>
<span class="header-section-number">12.4.1</span> Checking the Correlation Coefficients<a class="anchor" aria-label="anchor" href="#checking-the-correlation-coefficients"><i class="fas fa-link"></i></a>
</h3>
<p>Here, we calculate the correlation of original and re-expressed associations.</p>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span>, <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 0.891198</code></pre>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 0.9144307</code></pre>
<p>The Pearson correlation is a little stronger after the transformation. as we’d expect.</p>
</div>
<div id="using-the-testtransform-function" class="section level3" number="12.4.2">
<h3>
<span class="header-section-number">12.4.2</span> Using the <code>testTransform</code> function<a class="anchor" aria-label="anchor" href="#using-the-testtransform-function"><i class="fas fa-link"></i></a>
</h3>
<p>Here, we use the <code>testTransform</code> function (also from the <code>car</code> package) to compare the optimal choice determined by the powerTransform function (here <span class="math inline">\(\lambda\)</span> = 0.44) to <span class="math inline">\(\lambda\)</span> = 0 (logarithm), 0.5 (square root) and 1 (no transformation).</p>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/car/man/testTransform.html">testTransform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/powerTransform.html">powerTransform</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>                           LRT df      pval
LR test, lambda = (0) 46.17947  1 1.079e-11</code></pre>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/car/man/testTransform.html">testTransform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/powerTransform.html">powerTransform</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<pre><code>                             LRT df    pval
LR test, lambda = (0.5) 1.024888  1 0.31136</code></pre>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/car/man/testTransform.html">testTransform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/powerTransform.html">powerTransform</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>                           LRT df       pval
LR test, lambda = (1) 63.75953  1 1.4433e-15</code></pre>
<ul>
<li>It looks like only the square root (<span class="math inline">\(\lambda\)</span> = 0.5) of these three options is not significantly worse by the log-likelihood criterion applied here than the optimal choice.</li>
<li>That’s because it’s the only one with a <em>p</em> value larger than our usual standard for statistical significance, of 0.05.</li>
</ul>
</div>
<div id="comparing-the-residual-plots" class="section level3" number="12.4.3">
<h3>
<span class="header-section-number">12.4.3</span> Comparing the Residual Plots<a class="anchor" aria-label="anchor" href="#comparing-the-residual-plots"><i class="fas fa-link"></i></a>
</h3>
<p>We can fit the regression models, obtain plots of residuals against fitted values, and compare them to see which one has less indication of a curve in the residuals.</p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model.orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>
<span class="va">model.sqrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">scatter1</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">model.orig</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Y vs X Residual Plot"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">model.sqrt</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">scatter1</span><span class="op">$</span><span class="va">x</span>, y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Square Root Model Residuals"</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span></code></pre></div>
<div class="inline-figure"><img src="12_Reexpression_and_BoxCox_files/figure-html/unnamed-chunk-6-1.png" width="672"></div>
<p>What we’re looking for in such a plot is the absence of a curve, among other things, we want to see “fuzzy football” shapes.</p>
<p>As compared to the original residual plot, the square root version, is a modest improvement in this regard. It does look a bit less curved, and a bit more like a random cluster of points, so that’s nice. Usually, we can do a little better in real data, as shown in the next example from the NNYFS data we introduced in Chapter <a href="NYFS-Study.html#NYFS-Study">9</a>.</p>
</div>
</div>
<div id="an-example-from-the-nnyfs-data" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> An Example from the NNYFS data<a class="anchor" aria-label="anchor" href="#an-example-from-the-nnyfs-data"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnyfs</span> <span class="op">&lt;-</span> <span class="fu">read_rds</span><span class="op">(</span><span class="st">"data/nnyfs.Rds"</span><span class="op">)</span></code></pre></div>
<p>Using the subjects in the <code>nnyfs</code> data with complete data on the two variables of interest, let’s look at the relationship between arm circumference (the outcome, shown on the Y axis) and arm length (the predictor, shown on the X axis.)</p>
<div class="sourceCode" id="cb447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnyfs_c</span> <span class="op">&lt;-</span> <span class="va">nnyfs</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">arm_circ</span>, <span class="va">arm_length</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">SEQN</span>, <span class="va">arm_circ</span>, <span class="va">arm_length</span><span class="op">)</span></code></pre></div>
<div id="pearson-correlation-and-scatterplot" class="section level3" number="12.5.1">
<h3>
<span class="header-section-number">12.5.1</span> Pearson correlation and scatterplot<a class="anchor" aria-label="anchor" href="#pearson-correlation-and-scatterplot"><i class="fas fa-link"></i></a>
</h3>
<p>Here is the Pearson correlation between these two variables. Note the use of the <code><a href="https://magrittr.tidyverse.org/reference/exposition.html">%$%</a></code> pipe from the <code>magrittr</code> package to help tell the <code>cor</code> function which data to process.</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnyfs_c</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">arm_length</span>, <span class="va">arm_circ</span><span class="op">)</span></code></pre></div>
<pre><code>[1] 0.8120242</code></pre>
<p>Here’s the resulting scatterplot.</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nnyfs_c</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arm_length</span>, y <span class="op">=</span> <span class="va">arm_circ</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
                se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
                se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12_Reexpression_and_BoxCox_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<p>While the Pearson correlation is still quite strong, note that the loess smooth (shown in blue) bends up from the straight line model (shown in red) at both the low and high end of arm length.</p>
<p>Note also the use of <code>alpha = 0.2</code> to show the points with greater transparency than they would be shown normally (the default setting is no transparency with <code>alpha = 1</code>.)</p>
</div>
<div id="plotting-the-residuals" class="section level3" number="12.5.2">
<h3>
<span class="header-section-number">12.5.2</span> Plotting the Residuals<a class="anchor" aria-label="anchor" href="#plotting-the-residuals"><i class="fas fa-link"></i></a>
</h3>
<p>Now, let’s build a plot of residuals from the straight line model plotted against the arm length. We can obtain these residuals using the <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code> function from the <code>broom</code> package.</p>
<div class="sourceCode" id="cb451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">arm_circ</span> <span class="op">~</span> <span class="va">arm_length</span>, data <span class="op">=</span> <span class="va">nnyfs_c</span><span class="op">)</span>

<span class="va">nnyfs_c_aug1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">m1</span>, data <span class="op">=</span> <span class="va">nnyfs_c</span><span class="op">)</span>

<span class="va">nnyfs_c_aug1</span></code></pre></div>
<pre><code># A tibble: 1,511 x 9
    SEQN arm_circ arm_length .fitted .resid     .hat .sigma
   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
 1 71918     25.4       27.7    21.9  3.51  0.000695   3.21
 2 71919     26         38.4    30.4 -4.38  0.00253    3.21
 3 71920     37.9       35.9    28.4  9.50  0.00167    3.20
 4 71921     15.1       18.3    14.4  0.669 0.00304    3.21
 5 71922     29.5       34.2    27.0  2.45  0.00124    3.21
 6 71923     27.9       33      26.1  1.80  0.00100    3.21
 7 71924     17.6       26.5    20.9 -3.34  0.000788   3.21
 8 71925     17.7       24.2    19.1 -1.41  0.00113    3.21
 9 71926     19.9       26      20.5 -0.642 0.000844   3.21
10 71927     17.3       20      15.8  1.52  0.00234    3.21
# ... with 1,501 more rows, and 2 more variables:
#   .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</code></pre>
<p>OK. So the residuals are now stored in the <code>.resid</code> variable. We can create a residual plot, as follows.</p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nnyfs_c_aug1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arm_length</span>, y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, col <span class="op">=</span> <span class="st">"purple"</span>,
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Residuals show a curve."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12_Reexpression_and_BoxCox_files/figure-html/unnamed-chunk-11-1.png" width="672"></div>
</div>
<div id="using-the-box-cox-approach-to-identify-a-transformation" class="section level3" number="12.5.3">
<h3>
<span class="header-section-number">12.5.3</span> Using the Box-Cox approach to identify a transformation<a class="anchor" aria-label="anchor" href="#using-the-box-cox-approach-to-identify-a-transformation"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/car/man/boxCox.html">boxCox</a></span><span class="op">(</span><span class="va">nnyfs_c</span><span class="op">$</span><span class="va">arm_circ</span> <span class="op">~</span> <span class="va">nnyfs_c</span><span class="op">$</span><span class="va">arm_length</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="12_Reexpression_and_BoxCox_files/figure-html/unnamed-chunk-12-1.png" width="672"></div>
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/car/man/powerTransform.html">powerTransform</a></span><span class="op">(</span><span class="va">nnyfs_c</span><span class="op">$</span><span class="va">arm_circ</span> <span class="op">~</span> <span class="va">nnyfs_c</span><span class="op">$</span><span class="va">arm_length</span><span class="op">)</span></code></pre></div>
<pre><code>Estimated transformation parameter 
        Y1 
-0.9783135 </code></pre>
<p>This suggests that we should transform the <code>arm_circ</code> data by taking its inverse (power = -1.) Let’s take a look at that result.</p>
</div>
<div id="plots-after-inverse-transformation" class="section level3" number="12.5.4">
<h3>
<span class="header-section-number">12.5.4</span> Plots after Inverse Transformation<a class="anchor" aria-label="anchor" href="#plots-after-inverse-transformation"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s build (on the left) the revised scatterplot and (on the right) the revised residual plot after transforming the outcome (<code>arm_circ</code>) by taking its inverse.</p>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nnyfs_c</span> <span class="op">&lt;-</span> <span class="va">nnyfs_c</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>inv_arm_circ <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">arm_circ</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nnyfs_c</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arm_length</span>, y <span class="op">=</span> <span class="va">inv_arm_circ</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
                se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
                se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Transformation reduces curve"</span><span class="op">)</span>

<span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">inv_arm_circ</span> <span class="op">~</span> <span class="va">arm_length</span>, data <span class="op">=</span> <span class="va">nnyfs_c</span><span class="op">)</span>

<span class="va">nnyfs_c_aug2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">m2</span>, data <span class="op">=</span> <span class="va">nnyfs_c</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">nnyfs_c_aug2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">arm_length</span>, y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, col <span class="op">=</span> <span class="st">"purple"</span>,
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Residuals much improved"</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> 
    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Evaluating the Inverse Transformation"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="12_Reexpression_and_BoxCox_files/figure-html/unnamed-chunk-13-1.png" width="672"></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="straight-line-models.html"><span class="header-section-number">11</span> Straight Line Models</a></div>
<div class="next"><a href="studying-crab-claws-crabs.html"><span class="header-section-number">13</span> Studying Crab Claws (crabs)</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#linearizing-transformations"><span class="header-section-number">12</span> Linearizing Transformations</a></li>
<li><a class="nav-link" href="#linearize-the-association-between-quantitative-variables"><span class="header-section-number">12.1</span> “Linearize” The Association between Quantitative Variables</a></li>
<li>
<a class="nav-link" href="#the-box-cox-plot"><span class="header-section-number">12.2</span> The Box-Cox Plot</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#a-few-caveats"><span class="header-section-number">12.2.1</span> A Few Caveats</a></li></ul>
</li>
<li><a class="nav-link" href="#a-simulated-example"><span class="header-section-number">12.3</span> A Simulated Example</a></li>
<li>
<a class="nav-link" href="#checking-on-a-transformation-or-re-expression"><span class="header-section-number">12.4</span> Checking on a Transformation or Re-Expression</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#checking-the-correlation-coefficients"><span class="header-section-number">12.4.1</span> Checking the Correlation Coefficients</a></li>
<li><a class="nav-link" href="#using-the-testtransform-function"><span class="header-section-number">12.4.2</span> Using the testTransform function</a></li>
<li><a class="nav-link" href="#comparing-the-residual-plots"><span class="header-section-number">12.4.3</span> Comparing the Residual Plots</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#an-example-from-the-nnyfs-data"><span class="header-section-number">12.5</span> An Example from the NNYFS data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pearson-correlation-and-scatterplot"><span class="header-section-number">12.5.1</span> Pearson correlation and scatterplot</a></li>
<li><a class="nav-link" href="#plotting-the-residuals"><span class="header-section-number">12.5.2</span> Plotting the Residuals</a></li>
<li><a class="nav-link" href="#using-the-box-cox-approach-to-identify-a-transformation"><span class="header-section-number">12.5.3</span> Using the Box-Cox approach to identify a transformation</a></li>
<li><a class="nav-link" href="#plots-after-inverse-transformation"><span class="header-section-number">12.5.4</span> Plots after Inverse Transformation</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/THOMASELOVE/431-notes/blob/master/12_Reexpression_and_BoxCox.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/THOMASELOVE/431-notes/edit/master/12_Reexpression_and_BoxCox.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</strong>" was written by Thomas E. Love. It was last built on 2021-09-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
