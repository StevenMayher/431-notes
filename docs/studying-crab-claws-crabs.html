<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 13 Studying Crab Claws (crabs) | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</title>
<meta name="author" content="Thomas E. Love">
<meta name="description" content="For our next example, we’ll consider a study from zoology, specifically carcinology - the study of crustaceans. My source for these data is Chapter 7 in Fred L. Ramsey and Daniel W. Schafer30...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 13 Studying Crab Claws (crabs) | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta property="og:type" content="book">
<meta property="og:url" content="https://thomaselove.github.io/431-notes/studying-crab-claws-crabs.html">
<meta property="og:description" content="For our next example, we’ll consider a study from zoology, specifically carcinology - the study of crustaceans. My source for these data is Chapter 7 in Fred L. Ramsey and Daniel W. Schafer30...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 13 Studying Crab Claws (crabs) | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta name="twitter:description" content="For our next example, we’ll consider a study from zoology, specifically carcinology - the study of crustaceans. My source for these data is Chapter 7 in Fred L. Ramsey and Daniel W. Schafer30...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Working with These Notes</a></li>
<li><a class="" href="data-science.html"><span class="header-section-number">1</span> Data Science</a></li>
<li class="book-part">Part A. Exploring Data</li>
<li><a class="" href="the-palmer-penguins.html"><span class="header-section-number">2</span> The Palmer Penguins</a></li>
<li><a class="" href="nhanes1.html"><span class="header-section-number">3</span> NHANES: A First Look</a></li>
<li><a class="" href="data-structures-variable-types-sampling-nhanes.html"><span class="header-section-number">4</span> Data Structures, Variable Types &amp; Sampling NHANES</a></li>
<li><a class="" href="visualizing-nhanes-data.html"><span class="header-section-number">5</span> Visualizing NHANES Data</a></li>
<li><a class="" href="summarizing_quantities.html"><span class="header-section-number">6</span> Summarizing Quantities</a></li>
<li><a class="" href="summarizing-categories.html"><span class="header-section-number">7</span> Summarizing Categories</a></li>
<li><a class="" href="miss.html"><span class="header-section-number">8</span> Missing Data and Single Imputation</a></li>
<li><a class="" href="NYFS-Study.html"><span class="header-section-number">9</span> National Youth Fitness Survey</a></li>
<li><a class="" href="assessing-normality.html"><span class="header-section-number">10</span> Assessing Normality</a></li>
<li><a class="" href="straight-line-models.html"><span class="header-section-number">11</span> Straight Line Models</a></li>
<li><a class="" href="linearizing-transformations.html"><span class="header-section-number">12</span> Linearizing Transformations</a></li>
<li><a class="active" href="studying-crab-claws-crabs.html"><span class="header-section-number">13</span> Studying Crab Claws (crabs)</a></li>
<li><a class="" href="Hydrate-Study.html"><span class="header-section-number">14</span> Dehydration Recovery</a></li>
<li><a class="" href="WCGS-Study.html"><span class="header-section-number">15</span> The WCGS</a></li>
<li class="book-part">Part B. Comparing Summaries</li>
<li><a class="" href="confidence-intervals-for-a-mean.html"><span class="header-section-number">16</span> Confidence Intervals for a Mean</a></li>
<li><a class="" href="the-ibuprofen-in-sepsis-randomized-clinical-trial.html"><span class="header-section-number">17</span> The Ibuprofen in Sepsis Randomized Clinical Trial</a></li>
<li><a class="" href="comparing-means-with-paired-samples.html"><span class="header-section-number">18</span> Comparing Means with Paired Samples</a></li>
<li><a class="" href="hypothesis-testing-what-is-it-good-for.html"><span class="header-section-number">19</span> Hypothesis Testing: What is it good for?</a></li>
<li><a class="" href="two-examples-comparing-means.html"><span class="header-section-number">20</span> Two Examples Comparing Means</a></li>
<li><a class="" href="estimating-a-population-proportion.html"><span class="header-section-number">21</span> Estimating a Population Proportion</a></li>
<li><a class="" href="comparing-proportions-with-two-independent-samples.html"><span class="header-section-number">22</span> Comparing Proportions with Two Independent Samples</a></li>
<li><a class="" href="power-and-proportions.html"><span class="header-section-number">23</span> Power and Proportions</a></li>
<li><a class="" href="larger-contingency-tables.html"><span class="header-section-number">24</span> Larger Contingency Tables</a></li>
<li><a class="" href="analysis-of-variance.html"><span class="header-section-number">25</span> Analysis of Variance</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="some-r-tips.html">Some R Tips</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/THOMASELOVE/431-notes">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="studying-crab-claws-crabs" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> Studying Crab Claws (<code>crabs</code>)<a class="anchor" aria-label="anchor" href="#studying-crab-claws-crabs"><i class="fas fa-link"></i></a>
</h1>
<p>For our next example, we’ll consider a study from zoology, specifically carcinology - the study of crustaceans. My source for these data is Chapter 7 in <span class="citation"><a href="references.html#ref-RamseySchafer" role="doc-biblioref">Fred L. Ramsey and Daniel W. Schafer</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-RamseySchafer" role="doc-biblioref"&gt;&lt;em&gt;The Statistical Sleuth: A Course in Methods of Data Analysis&lt;/em&gt;, Second (Pacific Grove, CA: Duxbury, 2002)&lt;/a&gt;.&lt;/p&gt;'><sup>30</sup></a></span> which drew the data from a figure in <span class="citation"><a href="references.html#ref-Yamada1998" role="doc-biblioref">SB Yamada and EG Boulding</a>.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-Yamada1998" role="doc-biblioref"&gt;&lt;span&gt;“Claw Morphology, Prey Size Selection and Foraging Efficiency in Generalist and Specialist Shell-Breaking Crabs,”&lt;/span&gt; &lt;em&gt;Journal of Experimental Marine Biology and Ecology&lt;/em&gt; 220 (1998): 191–211, &lt;/a&gt;&lt;a href="http://www.science.oregonstate.edu/~yamadas/SylviaCV/BehrensYamada_Boulding1998.pdf" role="doc-biblioref"&gt;http://www.science.oregonstate.edu/~yamadas/SylviaCV/BehrensYamada_Boulding1998.pdf&lt;/a&gt;.&lt;/p&gt;'><sup>31</sup></a></span></p>
<p>The available data are the mean closing forces (in Newtons) and the propodus heights (mm) of the claws on 38 crabs that came from three different species. The <em>propodus</em> is the segment of the crab’s clawed leg with an immovable finger and palm.</p>
<div class="figure">
<img src="figures/crabanat.jpg" alt="Source: http://txmarspecies.tamug.edu/crustglossary.cfm" width="70%"><p class="caption">
(#fig:c13_crab1-fig)Source: <a href="http://txmarspecies.tamug.edu/crustglossary.cfm" class="uri">http://txmarspecies.tamug.edu/crustglossary.cfm</a>
</p>
</div>
<p>This was part of a study of the effects that predatory intertidal crab species have on populations of snails. The three crab species under study are:</p>
<ul>
<li>14 Hemigraspus nudus, also called the <a href="https://en.wikipedia.org/wiki/Purple_shore_crab">purple shore crab</a> (14 crabs)</li>
<li>12 Lophopanopeus bellus, also called the <a href="https://inverts.wallawalla.edu/Arthropoda/Crustacea/Malacostraca/Eumalacostraca/Eucarida/Decapoda/Brachyura/Family_Xanthidae/Lophopanopeus_bellus_bellus.html">black-clawed pebble crab</a>, and</li>
<li>12 Cancer productus, one of several species of <a href="https://en.wikipedia.org/wiki/Cancer_productus">red rock crabs</a> (12)</li>
</ul>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crabs</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/crabs.csv"</span><span class="op">)</span> </code></pre></div>
<pre><code>Rows: 38 Columns: 4</code></pre>
<pre><code>-- Column specification ------------------------------------
Delimiter: ","
chr (1): species
dbl (3): crab, force, height</code></pre>
<pre><code>
i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crabs</span></code></pre></div>
<pre><code># A tibble: 38 x 4
    crab species              force height
   &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt;
 1     1 Hemigraspus nudus      4      8  
 2     2 Lophopanopeus bellus  15.1    7.9
 3     3 Cancer productus       5      6.7
 4     4 Lophopanopeus bellus   2.9    6.6
 5     5 Hemigraspus nudus      3.2    5  
 6     6 Hemigraspus nudus      9.5    7.9
 7     7 Cancer productus      22.5    9.4
 8     8 Hemigraspus nudus      7.4    8.3
 9     9 Cancer productus      14.6   11.2
10    10 Lophopanopeus bellus   8.7    8.6
# ... with 28 more rows</code></pre>
<p>The <code>species</code> information is stored here as a character variable. How many different crabs are we talking about in each <code>species</code>?</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crabs</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span></code></pre></div>
<pre><code>              species  n   percent
     Cancer productus 12 0.3157895
    Hemigraspus nudus 14 0.3684211
 Lophopanopeus bellus 12 0.3157895</code></pre>
<p>As it turns out, we’re going to want to treat the <code>species</code> information as a <strong>factor</strong> with three levels, rather than as a character variable.</p>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crabs</span> <span class="op">&lt;-</span> <span class="va">crabs</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here’s a quick summary of the data. Take care to note the useless results for the first two variables. At least the function flags with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code> those variables it thinks are non-numeric.</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">psych</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/psych/man/describe.html">describe</a></span><span class="op">(</span><span class="va">crabs</span><span class="op">)</span></code></pre></div>
<pre><code>         vars  n  mean    sd median trimmed   mad min  max
crab        1 38 19.50 11.11  19.50   19.50 14.08   1 38.0
species*    2 38  2.00  0.81   2.00    2.00  1.48   1  3.0
force       3 38 12.13  8.98   8.70   11.53  9.04   2 29.4
height      4 38  8.81  2.23   8.25    8.78  2.52   5 13.1
         range skew kurtosis   se
crab      37.0 0.00    -1.30 1.80
species*   2.0 0.00    -1.50 0.13
force     27.4 0.47    -1.25 1.46
height     8.1 0.19    -1.14 0.36</code></pre>
<p>Actually, we’re more interested in these results after grouping by species.</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crabs</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">force</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 3 x 4
  species                  n `median(force)` `median(height)`
  &lt;fct&gt;                &lt;int&gt;           &lt;dbl&gt;            &lt;dbl&gt;
1 Cancer productus        12            19.7            11.0 
2 Hemigraspus nudus       14             3.7             7.9 
3 Lophopanopeus bellus    12            14.8             8.15</code></pre>
<div id="association-of-size-and-force" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Association of Size and Force<a class="anchor" aria-label="anchor" href="#association-of-size-and-force"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose we want to describe force on the basis of height, across all 38 crabs. We’ll add titles and identify the three species of crab, using shape and color.</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">height</span>, y <span class="op">=</span> <span class="va">force</span>, color <span class="op">=</span> <span class="va">species</span>, shape <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Crab Claw Force by Size"</span>, 
         x <span class="op">=</span> <span class="st">"Claw's propodus height (mm)"</span>, y <span class="op">=</span> <span class="st">"Mean closing force (N)"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch50-1.png" width="672"></div>
<p>A faceted plot for each species really highlights the difference in force between the <em>Hemigraspus nudus</em> and the other two species of crab.</p>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">height</span>, y <span class="op">=</span> <span class="va">force</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Crab Claw Force by Size"</span>, 
         x <span class="op">=</span> <span class="st">"Claw's propodus height (mm)"</span>, y <span class="op">=</span> <span class="st">"Mean closing force (N)"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch60-1.png" width="672"></div>
</div>
<div id="loess_smooth" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> The <code>loess</code> smooth<a class="anchor" aria-label="anchor" href="#loess_smooth"><i class="fas fa-link"></i></a>
</h2>
<p>We can obtain a smoothed curve (using several different approaches) to summarize the pattern presented by the data in any scatterplot. For instance, we might build such a plot for the complete set of 38 crabs, adding in a non-linear smooth function (called a loess smooth.)</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">height</span>, y <span class="op">=</span> <span class="va">force</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Crab Claw Force by Size"</span>, 
         x <span class="op">=</span> <span class="st">"Claw's propodus height (mm)"</span>, y <span class="op">=</span> <span class="st">"Mean closing force (N)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch70-1.png" width="672"></div>
<p>As we have discussed previously, a <strong>loess smooth</strong> fits a curve to data by tracking (at point x) the points within a neighborhood of point x, with more emphasis given to points near x. It can be adjusted by tweaking the <code>span</code> and <code>degree</code> parameters.</p>
<p>In addition to the curve, smoothing procedures can also provide confidence intervals around their main fitted line. Consider the following plot of the <code>crabs</code> information, which adjusts the span (from its default of 0.75) and also adds in the confidence intervals.</p>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">height</span>, y <span class="op">=</span> <span class="va">force</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, span <span class="op">=</span> <span class="fl">0.5</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Crab Claw Force by Size"</span>, 
         x <span class="op">=</span> <span class="st">"Claw's propodus height (mm)"</span>, y <span class="op">=</span> <span class="st">"Mean closing force (N)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch80-1.png" width="672"></div>
<p>By reducing the size of the span, our resulting picture shows a much less smooth function that we generated previously.</p>
<div id="smoothing-within-species" class="section level3" number="13.2.1">
<h3>
<span class="header-section-number">13.2.1</span> Smoothing within Species<a class="anchor" aria-label="anchor" href="#smoothing-within-species"><i class="fas fa-link"></i></a>
</h3>
<p>We can, of course, produce the plot above with separate smooths for each of the three species of crab.</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">height</span>, y <span class="op">=</span> <span class="va">force</span>, group <span class="op">=</span> <span class="va">species</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Crab Claw Force by Size"</span>, 
         x <span class="op">=</span> <span class="st">"Claw's propodus height (mm)"</span>, y <span class="op">=</span> <span class="st">"Mean closing force (N)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch90-1.png" width="672"></div>
<p>If we want to add in the confidence intervals (here I’ll show them at 90% rather than the default of 95%) then this plot should be faceted. Note that by default, what is displayed when <code>se = TRUE</code> are 95% prediction intervals - the <code>level</code> function in <code>stat_smooth</code> [which can be used in place of <code>geom_smooth</code>] is used here to change the coverage percentage from 95% to 90%.</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">height</span>, y <span class="op">=</span> <span class="va">force</span>, group <span class="op">=</span> <span class="va">species</span>, color <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, level <span class="op">=</span> <span class="fl">0.90</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Crab Claw Force by Size"</span>, 
         caption <span class="op">=</span> <span class="st">"with loess smooths and 90% confidence intervals"</span>,
         x <span class="op">=</span> <span class="st">"Claw's propodus height (mm)"</span>, y <span class="op">=</span> <span class="st">"Mean closing force (N)"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">species</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch100-1.png" width="672"></div>
<p>More on these and other confidence intervals later, especially in part B.</p>
</div>
</div>
<div id="fitting-a-linear-regression-model" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> Fitting a Linear Regression Model<a class="anchor" aria-label="anchor" href="#fitting-a-linear-regression-model"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose we plan to use a simple (least squares) linear regression model to describe force as a function of height. Is a least squares model likely to be an effective choice here?</p>
<p>The plot below shows the regression line predicting closing force as a function of propodus height. Here we annotate the plot to show the actual fitted regression line, which required fitting it with the <code>lm</code> statement prior to developing the graph.</p>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">force</span> <span class="op">~</span> <span class="va">height</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">height</span>, y <span class="op">=</span> <span class="va">force</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,  color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Crab Claw Force by Size with Linear Regression Model"</span>, 
         x <span class="op">=</span> <span class="st">"Claw's propodus height (mm)"</span>, y <span class="op">=</span> <span class="st">"Mean closing force (N)"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">11</span>, y <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"red"</span>, fontface <span class="op">=</span> <span class="st">"italic"</span>,
             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span> <span class="st">"Force - "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">3</span><span class="op">)</span>, <span class="st">" + "</span>, 
                            <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,<span class="fl">3</span><span class="op">)</span>, <span class="st">" Height"</span> <span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch110-1.png" width="672"></div>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<p>The <strong>lm</strong> function, again, specifies the linear model we fit to predict force using height. Here’s the summary.</p>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">force</span> <span class="op">~</span> <span class="va">height</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>
Call:
lm(formula = force ~ height, data = crabs)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.7945  -3.8113  -0.2394   4.1444  16.8814 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -11.0869     4.6224  -2.399   0.0218 *  
height        2.6348     0.5089   5.177 8.73e-06 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.892 on 36 degrees of freedom
Multiple R-squared:  0.4268,    Adjusted R-squared:  0.4109 
F-statistic:  26.8 on 1 and 36 DF,  p-value: 8.73e-06</code></pre>
<p>Again, the key things to realize are:</p>
<ul>
<li>The outcome variable in this model is <strong>force</strong>, and the predictor variable is <strong>height</strong>.</li>
<li>The straight line model for these data fitted by least squares is force = -11.1 + 2.63 height.</li>
<li>The slope of height is positive, which indicates that as height increases, we expect that force will also increase. Specifically, we expect that for every additional mm of height, the force will increase by 2.63 Newtons.</li>
<li>The multiple R-squared (squared correlation coefficient) is 0.427, which implies that 42.7% of the variation in force is explained using this linear model with height. It also implies that the Pearson correlation between force and height is the square root of 0.427, or 0.653.</li>
</ul>
</div>
<div id="is-a-linear-model-appropriate" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> Is a Linear Model Appropriate?<a class="anchor" aria-label="anchor" href="#is-a-linear-model-appropriate"><i class="fas fa-link"></i></a>
</h2>
<p>The zoology (at least as described in <span class="citation"><a href="references.html#ref-RamseySchafer" role="doc-biblioref">Ramsey and Schafer</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-RamseySchafer" role="doc-biblioref"&gt;&lt;em&gt;The Statistical Sleuth&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>32</sup></a></span>) suggests that the actual nature of the relationship would be represented by a log-log relationship, where the log of force is predicted by the log of height.</p>
<p>This log-log model is an appropriate model when we think that percentage increases in X (height, here) lead to constant percentage increases in Y (here, force).</p>
<p>To see the log-log model in action, we plot the log of force against the log of height. We could use either base 10 (log10 in R) or natural (log in R) logarithms.</p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">force</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Log-Log Model for Crabs data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch130-1.png" width="672"></div>
<p>The correlations between the raw force and height and between their logarithms turn out to be quite similar, and because the log transformation is monotone in these data, there’s actually no change at all in the Spearman correlations.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">Correlation of</th>
<th align="center">Pearson r</th>
<th align="center">Spearman r</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">force and height</td>
<td align="center">0.653</td>
<td align="center">0.657</td>
</tr>
<tr class="even">
<td align="center">log(force) and log(height)</td>
<td align="center">0.662</td>
<td align="center">0.657</td>
</tr>
</tbody>
</table></div>
<div id="the-log-log-model" class="section level3" number="13.4.1">
<h3>
<span class="header-section-number">13.4.1</span> The log-log model<a class="anchor" aria-label="anchor" href="#the-log-log-model"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crab_loglog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">force</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">crab_loglog</span><span class="op">)</span></code></pre></div>
<pre><code>
Call:
lm(formula = log(force) ~ log(height), data = crabs)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.5657 -0.4450  0.1884  0.4798  1.2422 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -2.7104     0.9251  -2.930  0.00585 ** 
log(height)   2.2711     0.4284   5.302 5.96e-06 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6748 on 36 degrees of freedom
Multiple R-squared:  0.4384,    Adjusted R-squared:  0.4228 
F-statistic: 28.11 on 1 and 36 DF,  p-value: 5.96e-06</code></pre>
<p>Our regression equation is log(force) = -2.71 + 2.27 log(height).</p>
<p>So, for example, if we found a crab with propodus height = 10 mm, our prediction for that crab’s claw force (in Newtons) based on this log-log model would be…</p>
<ul>
<li>log(force) = -2.71 + 2.27 log(10)</li>
<li>log(force) = -2.71 + 2.27 x 2.3025851</li>
<li>log(force) = 2.5190953</li>
<li>and so predicted force = exp(2.5190953) = 12.4173582 Newtons, which, naturally, we would round to 12.4 Newtons to match the data set’s level of precision.</li>
</ul>
</div>
<div id="how-does-this-compare-to-our-original-linear-model" class="section level3" number="13.4.2">
<h3>
<span class="header-section-number">13.4.2</span> How does this compare to our original linear model?<a class="anchor" aria-label="anchor" href="#how-does-this-compare-to-our-original-linear-model"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crab_linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">force</span> <span class="op">~</span> <span class="va">height</span>, data <span class="op">=</span> <span class="va">crabs</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">crab_linear</span><span class="op">)</span></code></pre></div>
<pre><code>
Call:
lm(formula = force ~ height, data = crabs)

Residuals:
     Min       1Q   Median       3Q      Max 
-16.7945  -3.8113  -0.2394   4.1444  16.8814 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -11.0869     4.6224  -2.399   0.0218 *  
height        2.6348     0.5089   5.177 8.73e-06 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.892 on 36 degrees of freedom
Multiple R-squared:  0.4268,    Adjusted R-squared:  0.4109 
F-statistic:  26.8 on 1 and 36 DF,  p-value: 8.73e-06</code></pre>
<p>The linear regression equation is force = -11.1 + 2.63 height.</p>
<p>So, for example, if we found a crab with propodus height = 10 mm, our prediction for that crab’s claw force (in Newtons) based on this linear model would be…</p>
<ul>
<li>force = -11.0869025 + 2.6348232 x 10</li>
<li>force = -11.0869025 + 26.3482321</li>
<li>so predicted force = 15.2613297, which we would round to 15.3 Newtons.</li>
</ul>
<p>So, it looks like the two models give meaningfully different predictions.</p>
</div>
</div>
<div id="making-predictions-with-a-model" class="section level2" number="13.5">
<h2>
<span class="header-section-number">13.5</span> Making Predictions with a Model<a class="anchor" aria-label="anchor" href="#making-predictions-with-a-model"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>broom</code> package’s <code>augment</code> function provides us with a consistent method for obtaining predictions (also called fitted values) for a new crab or for our original data. Suppose we want to predict the <code>force</code> level for two new crabs: one with height = 10 mm, and another with height = 12 mm.</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newcrab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>crab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Crab_A"</span>, <span class="st">"Crab_B"</span><span class="op">)</span>, height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">crab_linear</span>, newdata <span class="op">=</span> <span class="va">newcrab</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 2 x 3
  crab   height .fitted
  &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 Crab_A     10    15.3
2 Crab_B     12    20.5</code></pre>
<p>Should we want to obtain a prediction interval, we can use the <code>predict</code> function:</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">crab_linear</span>, newdata <span class="op">=</span> <span class="va">newcrab</span>, interval <span class="op">=</span> <span class="st">"prediction"</span>, level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></code></pre></div>
<pre><code>       fit      lwr      upr
1 15.26133 1.048691 29.47397
2 20.53098 5.994208 35.06774</code></pre>
<p>We’d interpret this result as saying that the linear model’s predicted force associated with a single new crab claw with propodus height 10 mm is 15.3 Newtons, and that a 95% prediction interval for the true value of such a force for such a claw is between 1.0 and 29.5 Newtons. More on prediction intervals later.</p>
<div id="predictions-after-a-transformation" class="section level3" number="13.5.1">
<h3>
<span class="header-section-number">13.5.1</span> Predictions After a Transformation<a class="anchor" aria-label="anchor" href="#predictions-after-a-transformation"><i class="fas fa-link"></i></a>
</h3>
<p>We can also get predictions from the log-log model. The default choice is a 95% prediction interval.</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">crab_loglog</span>, newdata <span class="op">=</span> <span class="va">newcrab</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></code></pre></div>
<pre><code>       fit      lwr      upr
1 2.519095 1.125900 3.912291
2 2.933174 1.515548 4.350800</code></pre>
<p>Of course, these predictions describe the <code><a href="https://rdrr.io/r/base/Log.html">log(force)</a></code> for such a crab claw. To get the prediction in terms of simple force, we’d need to back out of the logarithm, by exponentiating our point estimate and the prediction interval endpoints.</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">crab_loglog</span>, newdata <span class="op">=</span> <span class="va">newcrab</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>       fit      lwr      upr
1 12.41736 3.082989 50.01341
2 18.78716 4.551916 77.54044</code></pre>
<p>We’d interpret this result as saying, for the first new crab, that the log-log model’s predicted force associated with a single new crab claw with propodus height 10 mm is 12.4 Newtons, and that a 95% prediction interval for the true value of such a force for such a claw is between 3.1 and 50.0 Newtons.</p>
</div>
<div id="comparing-model-predictions" class="section level3" number="13.5.2">
<h3>
<span class="header-section-number">13.5.2</span> Comparing Model Predictions<a class="anchor" aria-label="anchor" href="#comparing-model-predictions"><i class="fas fa-link"></i></a>
</h3>
<p>Suppose we wish to build a plot of force vs height with a straight line for the linear model’s predictions, and a new curve for the log-log model’s predictions, so that we can compare and contrast the implications of the two models on a common scale. The <code>predict</code> function, when not given a new data frame, will use the existing predictor values that are in our <code>crabs</code> data. Such predictions are often called fitted values.</p>
<p>To put the two sets of predictions on the same scale despite the differing outcomes in the two models, we’ll exponentiate the results of the log-log model, and build a little data frame containing the heights and the predicted forces from that model.</p>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loglogdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>height <span class="op">=</span> <span class="va">crabs</span><span class="op">$</span><span class="va">height</span>, force <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">crab_loglog</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>A cleaner way to do this might be to use the <code>augment</code> function directly from <code>broom</code>:</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">crab_loglog</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 38 x 7
   `log(force)` `log(height)` .fitted   .hat .sigma  .cooksd
          &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1         1.39          2.08   2.01  0.0280  0.676 1.28e- 2
 2         2.71          2.07   1.98  0.0287  0.673 1.79e- 2
 3         1.61          1.90   1.61  0.0499  0.684 8.06e-10
 4         1.06          1.89   1.58  0.0530  0.679 1.69e- 2
 5         1.16          1.61   0.945 0.142   0.683 1.01e- 2
 6         2.25          2.07   1.98  0.0287  0.683 2.39e- 3
 7         3.11          2.24   2.38  0.0301  0.673 1.90e- 2
 8         2.00          2.12   2.10  0.0266  0.684 2.75e- 4
 9         2.68          2.42   2.78  0.0561  0.684 6.30e- 4
10         2.16          2.15   2.18  0.0263  0.684 5.34e- 6
# ... with 28 more rows, and 1 more variable:
#   .std.resid &lt;dbl&gt;</code></pre>
<p>Now, we’re ready to use the <code>geom_smooth</code> approach to plot the linear fit, and <code>geom_line</code> (which also fits curves) to display the log-log fit.</p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">crabs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">height</span>, y <span class="op">=</span> <span class="va">force</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, 
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, col<span class="op">=</span><span class="st">"blue"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">loglogdat</span>, col <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, <span class="fl">7</span>, <span class="fl">12</span>, label <span class="op">=</span> <span class="st">"Linear Model"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, <span class="fl">10</span>, <span class="fl">8</span>, label <span class="op">=</span> <span class="st">"Log-Log Model"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparing the Linear and Log-Log Models for Crab Claw data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="13_crabclaws_files/figure-html/c13_ch220-1.png" width="672"></div>
<p>Based on these 38 crabs, we see some modest differences between the predictions of the two models, with the log-log model predicting generally lower closing force for a given propodus height than would be predicted by a linear model.</p>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="linearizing-transformations.html"><span class="header-section-number">12</span> Linearizing Transformations</a></div>
<div class="next"><a href="Hydrate-Study.html"><span class="header-section-number">14</span> Dehydration Recovery</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#studying-crab-claws-crabs"><span class="header-section-number">13</span> Studying Crab Claws (crabs)</a></li>
<li><a class="nav-link" href="#association-of-size-and-force"><span class="header-section-number">13.1</span> Association of Size and Force</a></li>
<li>
<a class="nav-link" href="#loess_smooth"><span class="header-section-number">13.2</span> The loess smooth</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#smoothing-within-species"><span class="header-section-number">13.2.1</span> Smoothing within Species</a></li></ul>
</li>
<li><a class="nav-link" href="#fitting-a-linear-regression-model"><span class="header-section-number">13.3</span> Fitting a Linear Regression Model</a></li>
<li>
<a class="nav-link" href="#is-a-linear-model-appropriate"><span class="header-section-number">13.4</span> Is a Linear Model Appropriate?</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-log-log-model"><span class="header-section-number">13.4.1</span> The log-log model</a></li>
<li><a class="nav-link" href="#how-does-this-compare-to-our-original-linear-model"><span class="header-section-number">13.4.2</span> How does this compare to our original linear model?</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#making-predictions-with-a-model"><span class="header-section-number">13.5</span> Making Predictions with a Model</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#predictions-after-a-transformation"><span class="header-section-number">13.5.1</span> Predictions After a Transformation</a></li>
<li><a class="nav-link" href="#comparing-model-predictions"><span class="header-section-number">13.5.2</span> Comparing Model Predictions</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/THOMASELOVE/431-notes/blob/master/13_crabclaws.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/THOMASELOVE/431-notes/edit/master/13_crabclaws.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</strong>" was written by Thomas E. Love. It was last built on 2021-10-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
