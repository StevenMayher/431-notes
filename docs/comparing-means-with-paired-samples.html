<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 18 Comparing Means with Paired Samples | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</title>
<meta name="author" content="Thomas E. Love">
<meta name="description" content="Here, we’ll consider the problem of estimating a confidence interval to describe the difference in population means (or medians) based on a comparison of two samples of quantitative data, gathered...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Chapter 18 Comparing Means with Paired Samples | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta property="og:type" content="book">
<meta property="og:url" content="https://thomaselove.github.io/431-notes/comparing-means-with-paired-samples.html">
<meta property="og:description" content="Here, we’ll consider the problem of estimating a confidence interval to describe the difference in population means (or medians) based on a comparison of two samples of quantitative data, gathered...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 18 Comparing Means with Paired Samples | Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431">
<meta name="twitter:description" content="Here, we’ll consider the problem of estimating a confidence interval to describe the difference in population means (or medians) based on a comparison of two samples of quantitative data, gathered...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0/transition.js"></script><script src="libs/bs3compat-0.3.0/tabs.js"></script><script src="libs/bs3compat-0.3.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Working with These Notes</a></li>
<li><a class="" href="data-science.html"><span class="header-section-number">1</span> Data Science</a></li>
<li class="book-part">Part A. Exploring Data</li>
<li><a class="" href="the-palmer-penguins.html"><span class="header-section-number">2</span> The Palmer Penguins</a></li>
<li><a class="" href="nhanes1.html"><span class="header-section-number">3</span> NHANES: A First Look</a></li>
<li><a class="" href="data-structures-variable-types-sampling-nhanes.html"><span class="header-section-number">4</span> Data Structures, Variable Types &amp; Sampling NHANES</a></li>
<li><a class="" href="visualizing-nhanes-data.html"><span class="header-section-number">5</span> Visualizing NHANES Data</a></li>
<li><a class="" href="summarizing_quantities.html"><span class="header-section-number">6</span> Summarizing Quantities</a></li>
<li><a class="" href="summarizing-categories.html"><span class="header-section-number">7</span> Summarizing Categories</a></li>
<li><a class="" href="miss.html"><span class="header-section-number">8</span> Missing Data and Single Imputation</a></li>
<li><a class="" href="NYFS-Study.html"><span class="header-section-number">9</span> National Youth Fitness Survey</a></li>
<li><a class="" href="assessing-normality.html"><span class="header-section-number">10</span> Assessing Normality</a></li>
<li><a class="" href="straight-line-models.html"><span class="header-section-number">11</span> Straight Line Models</a></li>
<li><a class="" href="linearizing-transformations.html"><span class="header-section-number">12</span> Linearizing Transformations</a></li>
<li><a class="" href="studying-crab-claws-crabs.html"><span class="header-section-number">13</span> Studying Crab Claws (crabs)</a></li>
<li><a class="" href="Hydrate-Study.html"><span class="header-section-number">14</span> Dehydration Recovery</a></li>
<li><a class="" href="WCGS-Study.html"><span class="header-section-number">15</span> The WCGS</a></li>
<li class="book-part">Part B. Comparing Summaries</li>
<li><a class="" href="confidence-intervals-for-a-mean.html"><span class="header-section-number">16</span> Confidence Intervals for a Mean</a></li>
<li><a class="" href="the-ibuprofen-in-sepsis-randomized-clinical-trial.html"><span class="header-section-number">17</span> The Ibuprofen in Sepsis Randomized Clinical Trial</a></li>
<li><a class="active" href="comparing-means-with-paired-samples.html"><span class="header-section-number">18</span> Comparing Means with Paired Samples</a></li>
<li><a class="" href="hypothesis-testing-what-is-it-good-for.html"><span class="header-section-number">19</span> Hypothesis Testing: What is it good for?</a></li>
<li><a class="" href="two-examples-comparing-means.html"><span class="header-section-number">20</span> Two Examples Comparing Means</a></li>
<li><a class="" href="estimating-a-population-proportion.html"><span class="header-section-number">21</span> Estimating a Population Proportion</a></li>
<li><a class="" href="comparing-proportions-with-two-independent-samples.html"><span class="header-section-number">22</span> Comparing Proportions with Two Independent Samples</a></li>
<li><a class="" href="power-and-proportions.html"><span class="header-section-number">23</span> Power and Proportions</a></li>
<li><a class="" href="larger-contingency-tables.html"><span class="header-section-number">24</span> Larger Contingency Tables</a></li>
<li><a class="" href="analysis-of-variance.html"><span class="header-section-number">25</span> Analysis of Variance</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="some-r-tips.html">Some R Tips</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/THOMASELOVE/431-notes">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="comparing-means-with-paired-samples" class="section level1" number="18">
<h1>
<span class="header-section-number">18</span> Comparing Means with Paired Samples<a class="anchor" aria-label="anchor" href="#comparing-means-with-paired-samples"><i class="fas fa-link"></i></a>
</h1>
<p>Here, we’ll consider the problem of estimating a confidence interval to describe the difference in population means (or medians) based on a comparison of two samples of quantitative data, gathered using a matched pairs design.</p>
<p>Specifically, we’ll use as our example the Lead in the Blood of Children study, described below.</p>
<div id="lead-in-the-blood-of-children" class="section level2" number="18.1">
<h2>
<span class="header-section-number">18.1</span> Lead in the Blood of Children<a class="anchor" aria-label="anchor" href="#lead-in-the-blood-of-children"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>One of the best ways to eliminate a source of variation and the errors of interpretation associated with it is through the use of matched pairs. Each subject in one group is matched as closely as possible by a subject in the other group. If a 45-year-old African-American male with hypertension is given a [treatment designed to lower their blood pressure], then we give a second, similarly built 45-year old African-American male with hypertension a placebo.</p>
</blockquote>
<ul>
<li>
<span class="citation"><a href="references.html#ref-Good2005" role="doc-biblioref">Phillip I. Good</a>,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-Good2005" role="doc-biblioref"&gt;&lt;em&gt;Introduction to Statistics Through Resampling Methods and r/s-PLUS&lt;/em&gt; (Hoboken, NJ: Wiley, 2005)&lt;/a&gt;.&lt;/p&gt;'><sup>42</sup></a></span> section 5.2.4</li>
</ul>
</div>
<div id="the-lead-in-the-blood-of-children-study" class="section level2" number="18.2">
<h2>
<span class="header-section-number">18.2</span> The Lead in the Blood of Children Study<a class="anchor" aria-label="anchor" href="#the-lead-in-the-blood-of-children-study"><i class="fas fa-link"></i></a>
</h2>
<p><span class="citation"><a href="references.html#ref-Morton1982" role="doc-biblioref">D. Morton et al.</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-Morton1982" role="doc-biblioref"&gt;&lt;span&gt;“Lead Absorption in Children of Employees in a Lead Related Industry,”&lt;/span&gt; &lt;em&gt;American Journal of Epidemiology&lt;/em&gt; 115 (1982): 549–55&lt;/a&gt;.&lt;/p&gt;'><sup>43</sup></a></span> studied the absorption of lead into the blood of children. This was a matched-sample study, where the exposed group of interest contained 33 children of parents who worked in a battery manufacturing factory (where lead was used) in the state of Oklahoma. Specifically, each child with a lead-exposed parent was matched to another child of the same age, exposure to traffic, and living in the same neighborhood whose parents did not work in lead-related industries. So the complete study had 66 children, arranged in 33 matched pairs. The outcome of interest, gathered from a sample of whole blood from each of the children, was lead content, measured in mg/dl.</p>
<p>One motivation for doing this study is captured in the Abstract from <span class="citation"><a href="references.html#ref-Morton1982" role="doc-biblioref">Morton et al.</a><a href="#fn44" class="footnote-ref" id="fnref44"><sup>44</sup></a></span></p>
<blockquote>
<p>It has been repeatedly reported that children of employees in a lead-related industry are at increased risk of lead absorption because of the high levels of lead found in the household dust of these workers.</p>
</blockquote>
<p>The data are available in several places, including Table 5 of <span class="citation"><a href="references.html#ref-Pruzek2009" role="doc-biblioref">Robert M. Pruzek and James E. Helmreich</a>,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-Pruzek2009" role="doc-biblioref"&gt;&lt;span&gt;“Enhancing Dependent Sample Analyses with Graphics,”&lt;/span&gt; &lt;em&gt;Journal of Statistics Education&lt;/em&gt; 17(1) (2009), &lt;/a&gt;&lt;a href="http://ww2.amstat.org/publications/jse/v17n1/helmreich.html" role="doc-biblioref"&gt;http://ww2.amstat.org/publications/jse/v17n1/helmreich.html&lt;/a&gt;.&lt;/p&gt;'><sup>45</sup></a></span> in the BloodLead data set within the <code>PairedData</code> package in R, but we also make them available in the <code>bloodlead.csv</code> file. A table of the first few pairs of observations (blood lead levels for one child exposed to lead and the matched control) is shown below.</p>
<div class="sourceCode" id="cb681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bloodlead</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/bloodlead.csv"</span><span class="op">)</span></code></pre></div>
<pre><code>Rows: 33 Columns: 3</code></pre>
<pre><code>-- Column specification ------------------------------------
Delimiter: ","
chr (1): pair
dbl (2): exposed, control</code></pre>
<pre><code>
i Use `spec()` to retrieve the full column specification for this data.
i Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bloodlead</span></code></pre></div>
<pre><code># A tibble: 33 x 3
   pair  exposed control
   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 P01        38      16
 2 P02        23      18
 3 P03        41      18
 4 P04        18      24
 5 P05        37      19
 6 P06        36      11
 7 P07        23      10
 8 P08        62      15
 9 P09        31      16
10 P10        34      18
# ... with 23 more rows</code></pre>
<ul>
<li>In each pair, one child was exposed (to having a parent working in the factory) and the other was not.</li>
<li>Otherwise, though, each child was very similar to its matched partner.</li>
<li>The data under <code>exposed</code> and <code>control</code> are the blood lead content, in mg/dl.</li>
</ul>
<p>Our primary goal will be to estimate the difference in lead content between the exposed and control children, and then use that sample estimate to make inferences about the difference in lead content between the population of all children like those in the exposed group and the population of all children like those in the control group.</p>
<div id="our-key-questions-for-a-paired-samples-comparison" class="section level3" number="18.2.1">
<h3>
<span class="header-section-number">18.2.1</span> Our Key Questions for a Paired Samples Comparison<a class="anchor" aria-label="anchor" href="#our-key-questions-for-a-paired-samples-comparison"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>What is the <strong>population</strong> under study?</li>
</ol>
<ul>
<li>All pairs of children living in Oklahoma near the factory in question, in which one had a parent working in a factory that exposed them to lead, and the other did not.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>What is the <strong>sample</strong>? Is it representative of the population?</li>
</ol>
<ul>
<li>The sample consists of 33 pairs of one exposed and one control child.</li>
<li>This is a case-control study, where the children were carefully enrolled to meet the design criteria. Absent any other information, we’re likely to assume that there is no serious bias associated with these pairs, and that assuming they represent the population effectively (and perhaps the broader population of kids whose parents work in lead-based industries more generally) may well be at least as reasonable as assuming they don’t.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Who are the subjects / <strong>individuals</strong> within the sample?</li>
</ol>
<ul>
<li>Each of our 33 pairs of children includes one exposed child and one unexposed (control) child.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>What <strong>data</strong> are available on each individual?</li>
</ol>
<ul>
<li>The blood lead content, as measured in mg/dl of whole blood.</li>
</ul>
</div>
<div id="lead-study-caveats" class="section level3" number="18.2.2">
<h3>
<span class="header-section-number">18.2.2</span> Lead Study Caveats<a class="anchor" aria-label="anchor" href="#lead-study-caveats"><i class="fas fa-link"></i></a>
</h3>
<p>Note that the children were not randomly selected from general populations of kids whose parents did and did not work in lead-based industries.</p>
<ul>
<li>To make inferences to those populations, we must make <strong>strong assumptions</strong> to believe, for instance, that the sample of exposed children is as representative as a random sample of children with similar exposures across the world would be.</li>
<li>The researchers did have a detailed theory about how the exposed children might be at increased risk of lead absorption, and in fact as part of the study gathered additional information about whether a possible explanation might be related to the quality of hygiene of the parents (all of them were fathers, actually) who worked in the factory.</li>
<li>This is an observational study, so that the estimation of a causal effect between parental work in a lead-based industry and children’s blood lead content can be made, without substantial (and perhaps heroic) assumptions.</li>
</ul>
</div>
</div>
<div id="exploratory-data-analysis-for-paired-samples" class="section level2" number="18.3">
<h2>
<span class="header-section-number">18.3</span> Exploratory Data Analysis for Paired Samples<a class="anchor" aria-label="anchor" href="#exploratory-data-analysis-for-paired-samples"><i class="fas fa-link"></i></a>
</h2>
<p>We’ll begin by adjusting the data in two ways.</p>
<ul>
<li>We’d like that first variable (<code>pair</code>) to be a <code>factor</code> rather than a <code>character</code> type in R, because we want to be able to summarize it more effectively. So we’ll make that change.</li>
<li>Also, we’d like to calculate the difference in lead content between the exposed and the control children in each pair, and we’ll save that within-pair difference in a variable called <code>lead_diff</code>. We’ll take <code>lead_diff</code> = <code>exposed</code> - <code>control</code> so that positive values indicate increased lead in the exposed child.</li>
</ul>
<div class="sourceCode" id="cb687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bloodlead_original</span> <span class="op">&lt;-</span> <span class="va">bloodlead</span>

<span class="va">bloodlead</span> <span class="op">&lt;-</span> <span class="va">bloodlead_original</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span>,
           lead_diff <span class="op">=</span> <span class="va">exposed</span> <span class="op">-</span> <span class="va">control</span><span class="op">)</span>

<span class="va">bloodlead</span></code></pre></div>
<pre><code># A tibble: 33 x 4
   pair  exposed control lead_diff
   &lt;fct&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;
 1 P01        38      16        22
 2 P02        23      18         5
 3 P03        41      18        23
 4 P04        18      24        -6
 5 P05        37      19        18
 6 P06        36      11        25
 7 P07        23      10        13
 8 P08        62      15        47
 9 P09        31      16        15
10 P10        34      18        16
# ... with 23 more rows</code></pre>
<div id="the-paired-differences" class="section level3" number="18.3.1">
<h3>
<span class="header-section-number">18.3.1</span> The Paired Differences<a class="anchor" aria-label="anchor" href="#the-paired-differences"><i class="fas fa-link"></i></a>
</h3>
<p>To begin, we focus on <code>lead_diff</code> for our exploratory work, which is the <code>exposed</code> - <code>control</code> difference in lead content within each of the 33 pairs. So, we’ll have 33 observations, as compared to the 462 in the serum zinc data, but most of the same tools are still helpful.</p>
<div class="sourceCode" id="cb689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bloodlead</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">lead_diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">geom_qq</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"darkslategray"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">geom_qq_line</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"navy"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Normal Q-Q plot"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bloodlead</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lead_diff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>, 
                 binwidth <span class="op">=</span> <span class="fl">5</span>, fill <span class="op">=</span> <span class="st">"darkslategray"</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">dnorm</span>, 
                args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">bloodlead</span><span class="op">$</span><span class="va">lead_diff</span><span class="op">)</span>, 
                            sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">bloodlead</span><span class="op">$</span><span class="va">lead_diff</span><span class="op">)</span><span class="op">)</span>,
                col <span class="op">=</span> <span class="st">"navy"</span>, lwd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Histogram with Normal Density"</span><span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bloodlead</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lead_diff</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkslategray"</span>, outlier.color <span class="op">=</span> <span class="st">"darkslategray"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boxplot"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">+</span> <span class="op">(</span><span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Difference in Blood Lead Content (mg/dl) for 33 Pairs of Children"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="18_pairedsamples_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<p>Note that in all of this work, I plotted the paired differences. One obvious way to tell if you have paired samples is that you can pair every single subject from one exposure group to a unique subject in the other exposure group. Everyone has to be paired, so the sample sizes will always be the same in the two groups.</p>
<p>Here’s a summary of the paired differences.</p>
<div class="sourceCode" id="cb690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mosaic</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">favstats</a></span><span class="op">(</span><span class="op">~</span> <span class="va">lead_diff</span>, data <span class="op">=</span> <span class="va">bloodlead</span><span class="op">)</span></code></pre></div>
<pre><code> min Q1 median Q3 max    mean       sd  n missing
  -9  4     15 25  60 15.9697 15.86365 33       0</code></pre>
<div class="sourceCode" id="cb692"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bloodlead</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>skew1 <span class="op">=</span> 
                            <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">mean</a></span><span class="op">(</span><span class="va">lead_diff</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">median</a></span><span class="op">(</span><span class="va">lead_diff</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> 
                            <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">sd</a></span><span class="op">(</span><span class="va">lead_diff</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 1 x 1
   skew1
   &lt;dbl&gt;
1 0.0611</code></pre>
</div>
<div id="impact-of-matching---scatterplot-and-correlation" class="section level3" number="18.3.2">
<h3>
<span class="header-section-number">18.3.2</span> Impact of Matching - Scatterplot and Correlation<a class="anchor" aria-label="anchor" href="#impact-of-matching---scatterplot-and-correlation"><i class="fas fa-link"></i></a>
</h3>
<p>Here, the data are paired by the study through matching on neighborhood, age and exposure to traffic. Each individual child’s outcome value is part of a pair with the outcome value for his/her matching partner. We can see this pairing in several ways, perhaps by drawing a scatterplot of the pairs.</p>
<div class="sourceCode" id="cb694"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bloodlead</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">control</span>, y <span class="op">=</span> <span class="va">exposed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">20</span>, y <span class="op">=</span> <span class="fl">65</span>, col <span class="op">=</span> <span class="st">"blue"</span>, 
             label <span class="op">=</span> 
                 <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Pearson r = "</span>,
                       <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">bloodlead</span> <span class="op">%$%</span> 
                                 <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">cor</a></span><span class="op">(</span><span class="va">control</span>, <span class="va">exposed</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Paired Samples in Blood Lead study"</span>,
         x <span class="op">=</span> <span class="st">"Blood Lead Content (mg/dl) in Control Child"</span>,
         y <span class="op">=</span> <span class="st">"Blood Lead Content (mg/dl) in Exposed Child"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="18_pairedsamples_files/figure-html/unnamed-chunk-5-1.png" width="672"></div>
<p>Each point here represents a <strong>pair</strong> of observations, one from a control child, and one from the matched exposed child. If there is a strong linear relationship (usually with a positive slope, thus positive correlation) between the paired outcomes, then the pairing will be more helpful in terms of improving statistical power of the estimates we build than if there is a weak relationship.</p>
<ul>
<li>The stronger the Pearson correlation coefficient, the more helpful pairing will be.</li>
<li>Here, a straight line model using the control child’s blood lead content accounts for about 3.2% of the variation in blood lead content in the exposed child.</li>
<li>As it turns out, pairing will have only a modest impact here on the inferences we draw in the study. We still will treat the data as paired, despite this.</li>
</ul>
</div>
</div>
<div id="looking-at-separate-samples-using-pivot_longer" class="section level2" number="18.4">
<h2>
<span class="header-section-number">18.4</span> Looking at Separate Samples: Using <code>pivot_longer</code><a class="anchor" aria-label="anchor" href="#looking-at-separate-samples-using-pivot_longer"><i class="fas fa-link"></i></a>
</h2>
<p>For the purpose of estimating the difference between the exposed and control children, the summaries of the paired differences are what we’ll need.</p>
<p>In some settings, however, we might also look at a boxplot, or violin plot, or ridgeline plot that showed the distributions of exposed and control children separately. But we will run into trouble because one variable (blood lead content) is spread across multiple columns (control and exposed.) The solution is to “pivot” the tibble from its current format to build a new, tidy tibble. Because the data aren’t <em>tidied</em> here, so that we have one row for each subject and one column for each variable, we have to do some work to get them in that form for our usual plotting strategy to work well.</p>
<ul>
<li>
<code>pivot_longer()</code> “lengthens” the data, increasing the number of rows and decreasing the number of columns.</li>
<li>
<code>pivot_wider()</code> performs the inverse of that transformation, “widening” the data.</li>
</ul>
<p>In our original <code>bloodlead</code> data, if we drop the <code>lead_diff</code> addition we made, we have <em>wide</em> data, with each row representing two different subjects.</p>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bloodlead_original</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 3 x 3
  pair  exposed control
  &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 P01        38      16
2 P02        23      18
3 P03        41      18</code></pre>
<p>And what we want to accomplish is to have one row for each subject, instead of one row for each pair of subjects. So we want to make the data <strong>longer</strong>.</p>
<div class="sourceCode" id="cb697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bloodlead_longer</span> <span class="op">&lt;-</span> <span class="va">bloodlead_original</span> <span class="op">%&gt;%</span>
    <span class="fu">pivot_longer</span><span class="op">(</span>
        cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span>,
        names_to <span class="op">=</span> <span class="st">"status"</span>,
        values_to <span class="op">=</span> <span class="st">"lead_level"</span><span class="op">)</span>

<span class="va">bloodlead_longer</span></code></pre></div>
<pre><code># A tibble: 66 x 3
   pair  status  lead_level
   &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt;
 1 P01   exposed         38
 2 P01   control         16
 3 P02   exposed         23
 4 P02   control         18
 5 P03   exposed         41
 6 P03   control         18
 7 P04   exposed         18
 8 P04   control         24
 9 P05   exposed         37
10 P05   control         19
# ... with 56 more rows</code></pre>
<p>For more on this approach (in this case, we’re making the data “longer” and its opposite would be be making the data “wider”), visit the Tidy data chapter in <span class="citation"><a href="references.html#ref-R4DS" role="doc-biblioref">Grolemund and Wickham</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-R4DS" role="doc-biblioref"&gt;&lt;em&gt;R for Data Science&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>46</sup></a></span> and the tidyr repository on Github at <a href="https://github.com/tidyverse/tidyr" class="uri">https://github.com/tidyverse/tidyr</a>.</p>
<p>And now, we can plot as usual to compare the two samples.</p>
<p>First, we’ll look at a boxplot, showing all of the data.</p>
<div class="sourceCode" id="cb699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bloodlead_longer</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">status</span>, y <span class="op">=</span> <span class="va">lead_level</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">status</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>begin <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Boxplot of Lead Content in Exposed and Control kids"</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="18_pairedsamples_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
<p>We’ll also look at a ridgeline plot, because Dr. Love likes them, even though they’re really more useful when we’re comparing more than two samples.</p>
<div class="sourceCode" id="cb700"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">bloodlead_longer</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lead_level</span>, y <span class="op">=</span> <span class="va">status</span>, fill <span class="op">=</span> <span class="va">status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggridges</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/ggridges/reference/geom_density_ridges.html">geom_density_ridges</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Lead Content in Exposed and Control kids"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggridges</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/ggridges/reference/theme_ridges.html">theme_ridges</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>Picking joint bandwidth of 4.01</code></pre>
<div class="inline-figure"><img src="18_pairedsamples_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
<p>Both the center and the spread of the distribution are substantially larger in the exposed group than in the controls. Of course, numerical summaries show these patterns, too.</p>
<div class="sourceCode" id="cb702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">mosaic</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/aggregating.html">favstats</a></span><span class="op">(</span><span class="va">lead_level</span> <span class="op">~</span> <span class="va">status</span>, data <span class="op">=</span> <span class="va">bloodlead_longer</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">status</th>
<th align="right">min</th>
<th align="right">Q1</th>
<th align="right">median</th>
<th align="right">Q3</th>
<th align="right">max</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">n</th>
<th align="right">missing</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">control</td>
<td align="right">7</td>
<td align="right">13</td>
<td align="right">16</td>
<td align="right">19</td>
<td align="right">25</td>
<td align="right">15.88</td>
<td align="right">4.54</td>
<td align="right">33</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">exposed</td>
<td align="right">10</td>
<td align="right">21</td>
<td align="right">34</td>
<td align="right">39</td>
<td align="right">73</td>
<td align="right">31.85</td>
<td align="right">14.41</td>
<td align="right">33</td>
<td align="right">0</td>
</tr>
</tbody>
</table></div>
</div>
<div id="estimating-the-difference-in-means-with-paired-samples" class="section level2" number="18.5">
<h2>
<span class="header-section-number">18.5</span> Estimating the Difference in Means with Paired Samples<a class="anchor" aria-label="anchor" href="#estimating-the-difference-in-means-with-paired-samples"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose we want to estimate the difference in the mean blood level across the population of children represented by the sample taken in this study. To do so, we must take advantage of the matched samples design, and complete our estimation on the paired differences, treating them as if they were a single sample of data.</p>
<p>One way to accomplish this is simply to run the usual intercept-only linear regression model on the paired differences.</p>
<div class="sourceCode" id="cb703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_lead</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lead_diff</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">bloodlead</span><span class="op">)</span>

<span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_lead</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">15.97</td>
<td align="right">2.76</td>
<td align="right">5.78</td>
<td align="right">0</td>
<td align="right">11.29</td>
<td align="right">20.65</td>
</tr></tbody>
</table></div>
<p>Our point estimate for the difference (exposed - control) in lead levels is 15.97 mg/dl, and our 90% confidence interval is (11.29, 20.65) mg/dl.</p>
<div id="paired-data-in-longer-format" class="section level3" number="18.5.1">
<h3>
<span class="header-section-number">18.5.1</span> Paired Data in Longer Format?<a class="anchor" aria-label="anchor" href="#paired-data-in-longer-format"><i class="fas fa-link"></i></a>
</h3>
<p>If we had the data in “longer” format, as in <code>bloodlead_longer</code>, with the pairs identified by the <code>pair</code> variable, then we could obtained the same confidence interval using:</p>
<div class="sourceCode" id="cb704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model2_lead</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lead_level</span> <span class="op">~</span> <span class="va">status</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bloodlead_longer</span><span class="op">)</span>

<span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model2_lead</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span> </code></pre></div>
<pre><code># A tibble: 34 x 7
   term       estimate std.error statistic  p.value conf.low
   &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercep~    19.0       8.05    2.36    2.44e-2     5.38
 2 statusexp~    16.0       2.76    5.78    2.04e-6    11.3 
 3 factor(pa~    -6.50     11.2    -0.579   5.66e-1   -25.5 
 4 factor(pa~     2.50     11.2     0.223   8.25e-1   -16.5 
 5 factor(pa~    -6.00     11.2    -0.535   5.96e-1   -25.0 
 6 factor(pa~     1.00     11.2     0.0891  9.30e-1   -18.0 
 7 factor(pa~    -3.50     11.2    -0.312   7.57e-1   -22.5 
 8 factor(pa~   -10.5      11.2    -0.936   3.56e-1   -29.5 
 9 factor(pa~    11.5      11.2     1.03    3.13e-1    -7.50
10 factor(pa~    -3.50     11.2    -0.312   7.57e-1   -22.5 
# ... with 24 more rows, and 1 more variable:
#   conf.high &lt;dbl&gt;</code></pre>
<p>and the key elements are found in the <code>statusexposed</code> row, which we can focus on nicely (since the output of the <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> function is always a tibble) with:</p>
<div class="sourceCode" id="cb706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model2_lead</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.90</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"statusexposed"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">statusexposed</td>
<td align="right">15.97</td>
<td align="right">2.76</td>
<td align="right">5.78</td>
<td align="right">0</td>
<td align="right">11.29</td>
<td align="right">20.65</td>
</tr></tbody>
</table></div>
<p>and again, we have our 90% confidence interval estimate of the population mean difference between exposed and control children.</p>
</div>
</div>
<div id="matched-pairs-vs.-two-independent-samples" class="section level2" number="18.6">
<h2>
<span class="header-section-number">18.6</span> Matched Pairs vs. Two Independent Samples<a class="anchor" aria-label="anchor" href="#matched-pairs-vs.-two-independent-samples"><i class="fas fa-link"></i></a>
</h2>
<p>These data were NOT obtained from two independent samples, but rather from matched pairs.</p>
<ul>
<li>We only have matched pairs if each individual observation in the “treatment” group is matched to one and only one observation in the “control” group by the way in which the data were gathered. Paired (or matched) data can arise in several ways.
<ul>
<li>The most common is a “pre-post” study where subjects are measured both before and after an exposure happens.</li>
<li>In observational studies, we often match up subjects who did and did not receive an exposure so as to account for differences on things like age, sex, race and other covariates. This is what happens in the Lead in the Blood of Children study.</li>
</ul>
</li>
<li>If the data are from paired samples, we should (and in fact) must form paired differences, with no subject left unpaired.
<ul>
<li>If we cannot line up the data comparing two samples of quantitative data so that the links between the individual “treated” and “control” observations to form matched pairs are evident, then the data are not paired.</li>
<li>If the sample sizes were different, we’d know we have independent samples, because matched pairs requires that each subject in the “treated” group be matched to a single, unique member of the “control” group, and thus that we have exactly as many “treated” as “control” subjects.</li>
<li>But having as many subjects in one treatment group as the other (which is called a <em>balanced design</em>) is only necessary, and not sufficient, for us to conclude that matched pairs are used.</li>
</ul>
</li>
</ul>
<p>As <span class="citation"><a href="references.html#ref-BockVD" role="doc-biblioref">Bock, Velleman, and De Veaux</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references.html#ref-BockVD" role="doc-biblioref"&gt;&lt;em&gt;Stats&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;'><sup>47</sup></a></span> suggest,</p>
<blockquote>
<p>… if you know the data are paired, you can take advantage of that fact - in fact, you <em>must</em> take advantage of it. … You must decide whether the data are paired from understanding how they were collected and what they mean. … There is no test to determine whether the data are paired.</p>
</blockquote>
</div>
<div id="estimating-the-population-mean-of-the-paired-differences" class="section level2" number="18.7">
<h2>
<span class="header-section-number">18.7</span> Estimating the Population Mean of the Paired Differences<a class="anchor" aria-label="anchor" href="#estimating-the-population-mean-of-the-paired-differences"><i class="fas fa-link"></i></a>
</h2>
<p>There are two main approaches used frequently to estimate the population mean of paired differences.</p>
<ul>
<li>Estimation using the t distribution (and assuming at least an approximately Normal distribution for the paired differences)</li>
<li>Estimation using the bootstrap (which doesn’t require the Normal assumption)</li>
</ul>
<p>In addition, we might consider estimating an alternate statistic when the data don’t follow a symmetric distribution, like the median, with the bootstrap. In other settings, a rank-based alternative called the Wilcoxon signed rank test is available to estimate a psuedo-median. All of these approaches mirror what we did with a single sample, earlier in these Notes.</p>
</div>
<div id="t-based-ci-for-population-mean-of-paired-differences" class="section level2" number="18.8">
<h2>
<span class="header-section-number">18.8</span> t-based CI for Population Mean of Paired Differences<a class="anchor" aria-label="anchor" href="#t-based-ci-for-population-mean-of-paired-differences"><i class="fas fa-link"></i></a>
</h2>
<p>In R, there are at least five different methods for obtaining the t-based confidence interval for the population difference in means between paired samples. They are all mathematically identical. The key idea is to calculate the paired differences (exposed - control, for example) in each pair, and then treat the result as if it were a single sample and apply the methods developed for that situation earlier in these Notes.</p>
<div id="method-1" class="section level3" number="18.8.1">
<h3>
<span class="header-section-number">18.8.1</span> Method 1<a class="anchor" aria-label="anchor" href="#method-1"><i class="fas fa-link"></i></a>
</h3>
<p>We can use the single-sample approach, applied to the variable containing the paired differences. Let’s build a <strong>90%</strong> two-sided confidence interval for the population mean of the difference in blood lead content across all possible pairs of an exposed (parent works in a lead-based industry) and a control (parent does not) child.</p>
<div class="sourceCode" id="cb707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tt1</span> <span class="op">&lt;-</span> <span class="va">bloodlead</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/ttest.html">t.test</a></span><span class="op">(</span><span class="va">lead_diff</span>, conf.level <span class="op">=</span> <span class="fl">0.90</span>, 
                            alt <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span>

<span class="va">tt1</span></code></pre></div>
<pre><code>
    One Sample t-test

data:  lead_diff
t = 5.783, df = 32, p-value = 2.036e-06
alternative hypothesis: true mean is not equal to 0
90 percent confidence interval:
 11.29201 20.64738
sample estimates:
mean of x 
  15.9697 </code></pre>
<div class="sourceCode" id="cb709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">tt1</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">estimate</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">parameter</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
<th align="left">method</th>
<th align="left">alternative</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">15.97</td>
<td align="right">5.78</td>
<td align="right">0</td>
<td align="right">32</td>
<td align="right">11.29</td>
<td align="right">20.65</td>
<td align="left">One Sample t-test</td>
<td align="left">two.sided</td>
</tr></tbody>
</table></div>
<p>The 90% confidence interval is (11.29, 20.65) according to this t-based procedure. An appropriate interpretation of the 90% two-sided confidence interval would be:</p>
<ul>
<li>(11.29, 20.65) milligrams per deciliter is a 90% two-sided confidence interval for the population mean difference in blood lead content between exposed and control children.</li>
<li>Our point estimate for the true population difference in mean blood lead content is 15.97 mg.dl. The values in the interval (11.29, 20.65) mg/dl represent a reasonable range of estimates for the true population difference in mean blood lead content, and we are 90% confident that this method of creating a confidence interval will produce a result containing the true population mean difference.</li>
<li>Were we to draw 100 samples of 33 matched pairs from the population described by this sample, and use each such sample to produce a confidence interval in this manner, approximately 90 of those confidence intervals would cover the true population mean difference in blood lead content levels.</li>
</ul>
</div>
<div id="method-2" class="section level3" number="18.8.2">
<h3>
<span class="header-section-number">18.8.2</span> Method 2<a class="anchor" aria-label="anchor" href="#method-2"><i class="fas fa-link"></i></a>
</h3>
<p>Or, we can apply the single-sample approach to a calculated difference in blood lead content between the exposed and control groups. Here, we’ll get a <strong>95%</strong> two-sided confidence interval for that difference, instead of the 90% interval we obtained above.</p>
<div class="sourceCode" id="cb710"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tt2</span> <span class="op">&lt;-</span> <span class="va">bloodlead</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/ttest.html">t.test</a></span><span class="op">(</span><span class="va">exposed</span> <span class="op">-</span> <span class="va">control</span>, 
       conf.level <span class="op">=</span> <span class="fl">0.95</span>, alt <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span>

<span class="va">tt2</span></code></pre></div>
<pre><code>
    One Sample t-test

data:  exposed - control
t = 5.783, df = 32, p-value = 2.036e-06
alternative hypothesis: true mean is not equal to 0
95 percent confidence interval:
 10.34469 21.59470
sample estimates:
mean of x 
  15.9697 </code></pre>
<div class="sourceCode" id="cb712"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">tt2</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">estimate</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">parameter</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
<th align="left">method</th>
<th align="left">alternative</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">15.97</td>
<td align="right">5.78</td>
<td align="right">0</td>
<td align="right">32</td>
<td align="right">10.34</td>
<td align="right">21.59</td>
<td align="left">One Sample t-test</td>
<td align="left">two.sided</td>
</tr></tbody>
</table></div>
</div>
<div id="method-3" class="section level3" number="18.8.3">
<h3>
<span class="header-section-number">18.8.3</span> Method 3<a class="anchor" aria-label="anchor" href="#method-3"><i class="fas fa-link"></i></a>
</h3>
<p>Or, we can provide R with two separate samples (unaffected and affected) and specify that the samples are paired. Here, we’ll get a <strong>99%</strong> <strong>one-sided</strong> confidence interval (lower bound) for the population mean difference in blood lead content.</p>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tt3</span> <span class="op">&lt;-</span> <span class="va">bloodlead</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/ttest.html">t.test</a></span><span class="op">(</span><span class="va">exposed</span>, <span class="va">control</span>, conf.level <span class="op">=</span> <span class="fl">0.99</span>,
       paired <span class="op">=</span> <span class="cn">TRUE</span>, alt <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span>

<span class="va">tt3</span></code></pre></div>
<pre><code>
    Paired t-test

data:  exposed and control
t = 5.783, df = 32, p-value = 1.018e-06
alternative hypothesis: true difference in means is greater than 0
99 percent confidence interval:
 9.207658      Inf
sample estimates:
mean of the differences 
                15.9697 </code></pre>
<div class="sourceCode" id="cb715"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">tt3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">estimate</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
<th align="right">parameter</th>
<th align="right">conf.low</th>
<th align="right">conf.high</th>
<th align="left">method</th>
<th align="left">alternative</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">15.97</td>
<td align="right">5.78</td>
<td align="right">0</td>
<td align="right">32</td>
<td align="right">9.21</td>
<td align="right">Inf</td>
<td align="left">Paired t-test</td>
<td align="left">greater</td>
</tr></tbody>
</table></div>
<p>Again, the three different methods using <code>t.test</code> for paired samples will all produce identical results if we feed them the same confidence level and type of interval (two-sided, greater than or less than).</p>
</div>
<div id="method-4" class="section level3" number="18.8.4">
<h3>
<span class="header-section-number">18.8.4</span> Method 4<a class="anchor" aria-label="anchor" href="#method-4"><i class="fas fa-link"></i></a>
</h3>
<p>We can also use an intercept-only linear regression model to estimate the population mean of the paired differences with a two-tailed confidence interval, by creating a variable containing those paired differences.</p>
<div class="sourceCode" id="cb716"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_lead</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lead_diff</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">bloodlead</span><span class="op">)</span>

<span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model_lead</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 1 x 7
  term        estimate std.error statistic  p.value conf.low
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)     16.0      2.76      5.78  2.04e-6     10.3
# ... with 1 more variable: conf.high &lt;dbl&gt;</code></pre>
</div>
<div id="method-5" class="section level3" number="18.8.5">
<h3>
<span class="header-section-number">18.8.5</span> Method 5<a class="anchor" aria-label="anchor" href="#method-5"><i class="fas fa-link"></i></a>
</h3>
<p>If we have the data in a longer format, with a variable identifying the matched pairs, we can use a different specification for a linear model to obtain the same estimate.</p>
<div class="sourceCode" id="cb718"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model2_lead</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">lead_level</span> <span class="op">~</span> <span class="va">status</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">bloodlead_longer</span><span class="op">)</span>

<span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">model2_lead</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, conf.level <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"statusexposed"</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 1 x 7
  term          estimate std.error statistic p.value conf.low
  &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 statusexposed     16.0      2.76      5.78 2.04e-6     10.3
# ... with 1 more variable: conf.high &lt;dbl&gt;</code></pre>
</div>
<div id="assumptions" class="section level3" number="18.8.6">
<h3>
<span class="header-section-number">18.8.6</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"><i class="fas fa-link"></i></a>
</h3>
<p>If we are building a confidence interval based on a sample of observations drawn from a population, then we must pay close attention to the assumptions of those procedures. The confidence interval procedure for the population mean paired difference using the t distribution assumes that:</p>
<ol style="list-style-type: decimal">
<li>We want to estimate the population mean paired difference.</li>
<li>We have drawn a sample of paired differences at random from the population of interest.</li>
<li>The sampled paired differences are drawn from the population set of paired differences independently and have identical distributions.</li>
<li>The population follows a Normal distribution. At the very least, the sample itself is approximately Normal.</li>
</ol>
</div>
</div>
<div id="bootstrap-ci-for-mean-difference-using-paired-samples" class="section level2" number="18.9">
<h2>
<span class="header-section-number">18.9</span> Bootstrap CI for mean difference using paired samples<a class="anchor" aria-label="anchor" href="#bootstrap-ci-for-mean-difference-using-paired-samples"><i class="fas fa-link"></i></a>
</h2>
<p>The same bootstrap approach is used for paired differences as for a single sample. We use the <code>smean.cl.boot()</code> function in the <code>Hmisc</code> package to obtain bootstrap confidence intervals for the population mean of the paired differences in blood lead content.</p>
<div class="sourceCode" id="cb720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">431555</span><span class="op">)</span>
<span class="va">bloodlead</span> <span class="op">%$%</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html">smean.cl.boot</a></span><span class="op">(</span><span class="va">lead_diff</span>, B <span class="op">=</span> <span class="fl">1000</span>,
                                   conf.int <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></code></pre></div>
<pre><code>    Mean    Lower    Upper 
15.96970 10.81742 21.48788 </code></pre>
<p>Note that in this case, the confidence interval for the difference in means is a bit less wide than the 95% confidence interval generated by the t test, which was (10.34, 21.59). It’s common for the bootstrap to produce a narrower range (i.e. an apparently more precise estimate) for the population mean, but it’s not automatic that the endpoints from the bootstrap will be inside those provided by the t test, either.</p>
<p>For example, this bootstrap CI doesn’t contain the t-test based interval, since its upper bound exceeds that of the t-based interval:</p>
<div class="sourceCode" id="cb722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">431002</span><span class="op">)</span>
<span class="va">bloodlead</span> <span class="op">%$%</span> <span class="fu">Hmisc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/smean.sd.html">smean.cl.boot</a></span><span class="op">(</span><span class="va">lead_diff</span>, B <span class="op">=</span> <span class="fl">1000</span>,
                                   conf.int <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></code></pre></div>
<pre><code>    Mean    Lower    Upper 
15.96970 10.81667 21.66667 </code></pre>
<p>This demonstration aside, the appropriate thing to do when applying the bootstrap to specify a confidence interval is select a seed and the number (<code>B</code> = 1,000 or 10,000, usually) of desired bootstrap replications, then run the bootstrap just once and move on, rather than repeating the process multiple times looking for a particular result.</p>
<div id="assumptions-1" class="section level3" number="18.9.1">
<h3>
<span class="header-section-number">18.9.1</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions-1"><i class="fas fa-link"></i></a>
</h3>
<p>The bootstrap confidence interval procedure for the population mean (or median) of a set of paired differences assumes that:</p>
<ol style="list-style-type: decimal">
<li>We want to estimate the population mean of the paired differences (or the population median).</li>
<li>We have drawn a sample of observations at random from the population of interest.</li>
<li>The sampled observations are drawn from the population of paired differences independently and have identical distributions.</li>
<li>We are willing to put up with the fact that different people (not using the same random seed) will get somewhat different confidence interval estimates using the same data.</li>
</ol>
<p>As we’ve seen, a major part of the bootstrap’s appeal is the ability to relax some assumptions.</p>
</div>
</div>
<div id="wilcoxon-signed-rank-based-ci-for-paired-samples" class="section level2" number="18.10">
<h2>
<span class="header-section-number">18.10</span> Wilcoxon Signed Rank-based CI for paired samples<a class="anchor" aria-label="anchor" href="#wilcoxon-signed-rank-based-ci-for-paired-samples"><i class="fas fa-link"></i></a>
</h2>
<p>We could also use the Wilcoxon signed rank procedure to generate a CI for the pseudo-median of the paired differences.</p>
<div class="sourceCode" id="cb724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wt</span> <span class="op">&lt;-</span> <span class="va">bloodlead</span> <span class="op">%$%</span> <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html">wilcox.test</a></span><span class="op">(</span><span class="va">lead_diff</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>,
                                conf.level <span class="op">=</span> <span class="fl">0.90</span>, 
                                exact <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">wt</span></code></pre></div>
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  lead_diff
V = 499, p-value = 1.155e-05
alternative hypothesis: true location is not equal to 0
90 percent confidence interval:
 10.99992 20.49998
sample estimates:
(pseudo)median 
      15.49996 </code></pre>
<div class="sourceCode" id="cb726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">wt</span><span class="op">)</span></code></pre></div>
<pre><code># A tibble: 1 x 7
  estimate statistic   p.value conf.low conf.high method    
     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     
1     15.5       499 0.0000115     11.0      20.5 Wilcoxon ~
# ... with 1 more variable: alternative &lt;chr&gt;</code></pre>
<p>As in the one sample case, we can revise this code slightly to specify a different confidence level, or gather a one-sided rather than a two-sided confidence interval.</p>
<div id="assumptions-2" class="section level3" number="18.10.1">
<h3>
<span class="header-section-number">18.10.1</span> Assumptions<a class="anchor" aria-label="anchor" href="#assumptions-2"><i class="fas fa-link"></i></a>
</h3>
<p>The Wilcoxon signed rank confidence interval procedure in working with paired differences assumes that:</p>
<ol style="list-style-type: decimal">
<li>We want to estimate the population <strong>pseudo-median</strong> of the paired differences.</li>
<li>We have drawn a sample of observations at random from the population of paired differences of interest.</li>
<li>The sampled observations are drawn from the population of paired differences independently and have identical distributions.</li>
<li>The population follows a symmetric distribution. At the very least, the sample itself shows no substantial skew, so that the sample pseudo-median is a reasonable estimate for the population median.</li>
</ol>
</div>
</div>
<div id="choosing-a-confidence-interval-approach" class="section level2" number="18.11">
<h2>
<span class="header-section-number">18.11</span> Choosing a Confidence Interval Approach<a class="anchor" aria-label="anchor" href="#choosing-a-confidence-interval-approach"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose we want to find a confidence interval for the population mean difference between two populations based on matched pairs.</p>
<ol style="list-style-type: decimal">
<li>If we are willing to assume that the population distribution is <strong>Normal</strong>
<ul>
<li>we usually use a t-based CI.</li>
</ul>
</li>
<li>If we are <strong>unwilling</strong> to assume that the population is Normal,
<ul>
<li>use a <strong>bootstrap</strong> procedure to get a CI for the population mean, or even the median</li>
<li>but are willing to assume the population is symmetric, consider a <strong>Wilcoxon signed rank</strong> procedure to get a CI for the median, rather than the mean.</li>
</ul>
</li>
</ol>
<p>The two methods you’ll use most often are the bootstrap (especially if the data don’t appear to be at least pretty well fit by a Normal model) and the t-based confidence intervals (if the data do appear to fit a Normal model reasonably well.)</p>
</div>
<div id="conclusions-for-the-bloodlead-study" class="section level2" number="18.12">
<h2>
<span class="header-section-number">18.12</span> Conclusions for the <code>bloodlead</code> study<a class="anchor" aria-label="anchor" href="#conclusions-for-the-bloodlead-study"><i class="fas fa-link"></i></a>
</h2>
<p>Using any of these procedures, we would conclude that the null hypothesis (that the true mean of the paired Exposed - Control differences is 0 mg/dl) is not consonant with what we see in the 90% confidence interval.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">Procedure</th>
<th align="right">Comparing</th>
<th align="right">90% CI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">Paired t</td>
<td align="right">Means</td>
<td align="right">11.3, 20.6</td>
</tr>
<tr class="even">
<td align="right">Wilcoxon signed rank</td>
<td align="right">Pseudo-medians</td>
<td align="right">11, 20.5</td>
</tr>
<tr class="odd">
<td align="right">Bootstrap CI</td>
<td align="right">Means</td>
<td align="right">11.6, 20.6</td>
</tr>
</tbody>
</table></div>
<p>Note that <strong>one-sided</strong> or <strong>one-tailed</strong> hypothesis testing procedures work the same way for paired samples as they did for a single sample.</p>
</div>
<div id="the-sign-test" class="section level2" number="18.13">
<h2>
<span class="header-section-number">18.13</span> The Sign test<a class="anchor" aria-label="anchor" href="#the-sign-test"><i class="fas fa-link"></i></a>
</h2>
<p>The <strong>sign test</strong> is something we’ve skipped in our discussion so far. It is a test for consistent differences between pairs of observations, just as the paired t, Wilcoxon signed rank and bootstrap for paired samples can provide. It has the advantage that it is relatively easy to calculate by hand, and that it doesn’t require the paired differences to follow a Normal distribution. In fact, it will even work if the data are substantially skewed.</p>
<ul>
<li>Calculate the paired difference for each pair, and drop those with difference = 0.</li>
<li>Let <em>N</em> be the number of pairs that remain, so there are 2N data points.</li>
<li>Let <em>W</em>, the test statistic, be the number of pairs (out of N) in which the difference is positive.</li>
<li>Assuming that H0 is true, then <em>W</em> follows a binomial distribution with probability 0.5 on <em>N</em> trials.</li>
</ul>
<p>For example, consider our data on blood lead content:</p>
<div class="sourceCode" id="cb728"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bloodlead</span><span class="op">$</span><span class="va">lead_diff</span></code></pre></div>
<pre><code> [1] 22  5 23 -6 18 25 13 47 15 16  6  1  2  7  0  4 -9 -3
[19] 36 25  1 16 42 30 25 23 32 17  9 -3 60 14 14</code></pre>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">Difference</th>
<th align="right"># of Pairs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">Greater than zero</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="right">Equal to zero</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">Less than zero</td>
<td align="right">4</td>
</tr>
</tbody>
</table></div>
<p>So we have <em>N</em> = 32 pairs, with <span class="math inline">\(W\)</span> = 28 that are positive. We then use the <code>binom.test</code> approach in R:</p>
<div class="sourceCode" id="cb730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mosaic/man/binom.test.html">binom.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">28</span>, n <span class="op">=</span> <span class="fl">32</span>, p <span class="op">=</span> <span class="fl">0.5</span>, 
           alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span></code></pre></div>
<pre><code>


data:  28 out of 32
number of successes = 28, number of trials = 32,
p-value = 1.93e-05
alternative hypothesis: true probability of success is not equal to 0.5
95 percent confidence interval:
 0.7100516 0.9648693
sample estimates:
probability of success 
                 0.875 </code></pre>
<ul>
<li>A one-tailed test can be obtained by substituting in “less” or “greater” as the alternative of interest.</li>
<li>The confidence interval provided doesn’t relate back to our original population means. It’s just showing the confidence interval around the probability of the exposed mean being greater than the control mean for a pair of children.</li>
</ul>
</div>
<div id="paired-dependent-vs.-independent-samples" class="section level2" number="18.14">
<h2>
<span class="header-section-number">18.14</span> Paired (Dependent) vs. Independent Samples<a class="anchor" aria-label="anchor" href="#paired-dependent-vs.-independent-samples"><i class="fas fa-link"></i></a>
</h2>
<p>One area that consistently trips students up in this course is the thought process involved in distinguishing studies comparing means that should be analyzed using <em>dependent</em> (i.e. paired or matched) samples and those which should be analyzed using <em>independent</em> samples. A dependent samples analysis uses additional information about the sample to pair/match subjects receiving the various exposures. That additional information is not part of an independent samples analysis (unpaired testing situation.) The reasons to do this are to (a) increase statistical power, and/or (b) reduce the effect of confounding. Here are a few thoughts on the subject.</p>
<p>In the design of experiments, <strong>blocking</strong> is the term often used for the process of arranging subjects into groups (blocks) that are similar to one another. Typically, a blocking factor is a source of variability that is not of primary interest to the researcher An example of a blocking factor might be the sex of a patient; by blocking on sex, this source of variability is controlled for, thus leading to greater accuracy.</p>
<ol style="list-style-type: decimal">
<li><p>If the sample sizes are not balanced (not equal), the samples must be treated as independent, since there would be no way to precisely link all subjects. So, if we have 10 subjects receiving exposure A and 12 subjects receiving exposure B, a dependent samples analysis (such as a paired <em>t</em> test) is not correct.</p></li>
<li><p>The key element is a meaningful link between each observation in one exposure group and a specific observation in the other exposure group. Given a balanced design, the most common strategy indicating dependent samples involves two or more <em>repeated measures</em> on the same subjects. For example, if we are comparing outcomes <em>before</em> and <em>after</em> the application of an exposure, and we have, say, 20 subjects who provide us data both <em>before</em> and <em>after</em> the exposure, then the comparison of results <em>before</em> and <em>after</em> exposure should use a dependent samples analysis. The link between the subjects is the subject itself - each exposed subject serves as its own control.</p></li>
<li><p>The second most common strategy indicating dependent samples involves deliberate matching of subjects receiving the two exposures. A matched set of observations (often a pair, but it could be a trio or quartet, etc.) is determined using baseline information and then (if a pair is involved) one subject receives exposure A while the other member of the pair receives exposure B, so that by calculating the paired difference, we learn about the effect of the exposure, while controlling for the variables made similar across the two subjects by the matching process.</p></li>
<li><p>In order for a dependent samples analysis to be used, we need (a) a link between each observation across the exposure groups based on the way the data were collected, <em>and</em> (b) a consistent measure (with the same units of measurement) so that paired differences can be calculated and interpreted sensibly.</p></li>
<li><p>If the samples are collected to facilitate a dependent samples analysis, the correlation of the outcome measurements across the groups will often be moderately strong and positive. If that’s the case, then the use of a dependent samples analysis will reduce the effect of baseline differences between the exposure groups, and thus provide a more precise estimate. But even if the correlation is quite small, a dependent samples analysis should provide a more powerful estimate of the impact of the exposure on the outcome than would an independent samples analysis with the same number of observations.</p></li>
</ol>
<div id="three-tricky-examples" class="section level3" number="18.14.1">
<h3>
<span class="header-section-number">18.14.1</span> Three “Tricky” Examples<a class="anchor" aria-label="anchor" href="#three-tricky-examples"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li><p>Suppose we take a convenient sample of 200 patients from the population of patients who complete a blood test in April 2017 including a check of triglycerides, and who have a triglyceride level in the high category (200 to 499 mg/dl). Next, we select a patient at random from this group of 200 patients, and then identify another patient from the group of 200 who is the same age (to within 2 years) and also the same sex. We then randomly assign our intervention to one of these two patients and usual care without our intervention to the other patient. We then set these two patients aside and return to our original sample, repeating the process until we cannot find any more patients in the same age range and of the same gender. This generates a total of 77 patients who receive the intervention and 77 who do not. If we are trying to assess the effect of our intervention on triglyceride level in October 2017 using this sample of 154 people, should we use dependent (paired) or independent samples?</p></li>
<li><p>Suppose we take a convenient sample of 77 patients from the population of patients who complete a blood test in April 2017 including a check of triglycerides, and who have a triglyceride level in the high category (200 to 499 mg/dl). Next, we take a convenient sample of 77 patients from the population of patients who complete a blood test in May 2017 including a check of triglycerides, and who have a triglyceride level in the high category (200 to 499 mg/dl). We flip a coin to determine whether the intervention will be given to each of the 77 patients from April 2017 (if the coin comes up “HEADS”) or instead to each of the 77 patients from May 2017 (if the coin comes up “TAILS”). Then, we assign our intervention to the patients seen in the month specified by the coin and assign usual care without our intervention to the patients seen in the other month. If we are trying to assess the effect of our intervention on triglyceride level in October 2017 using this sample of 154 people, should we use dependent (paired) or independent samples?</p></li>
<li><p>Suppose we take a convenient sample of 200 patients from the population of patients who complete a blood test in April 2017 including a check of triglycerides, and who have a triglyceride level in the high category (200 to 499 mg/dl). For each patient, we re-measure them again in October 2017, again checking their triglyceride level. But in between, we take the first 77 of the patients in a randomly sorted list and assign them to our intervention (which takes place from June through September 2017) and take an additional group of 77 patients from the remaining part of the list and assign them to usual care without our intervention over the same time period. If we are trying to assess the effect of our intervention on each individual’s change in triglyceride level (from April/May to October) using this sample of 154 people, should we use dependent (paired) or independent samples?</p></li>
</ol>
<p>Answers to these “tricky” examples appear at the end of this Chapter.</p>
</div>
</div>
<div id="a-more-complete-decision-support-tool-comparing-means" class="section level2" number="18.15">
<h2>
<span class="header-section-number">18.15</span> A More Complete Decision Support Tool: Comparing Means<a class="anchor" aria-label="anchor" href="#a-more-complete-decision-support-tool-comparing-means"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Are these paired or independent samples?</p></li>
<li>
<p>If paired samples, then are the paired differences approximately Normally distributed?</p>
<ol style="list-style-type: lower-alpha">
<li>If yes, then a paired t test or confidence interval is likely the best choice.</li>
<li>If no, is the main concern outliers (with generally symmetric data), or skew?
<ol style="list-style-type: decimal">
<li>If the paired differences appear to be generally symmetric but with substantial outliers, a Wilcoxon signed rank test is an appropriate choice, as is a bootstrap confidence interval for the population mean of the paired differences.</li>
<li>If the paired differences appear to be seriously skewed, then we’ll usually build a bootstrap confidence interval, although a sign test is another reasonable possibility, although it doesn’t provide a confidence interval for the population mean of the paired differences.</li>
</ol>
</li>
</ol>
</li>
<li>
<p>If independent, is each sample Normally distributed?</p>
<ol style="list-style-type: lower-alpha">
<li>No –&gt; use Wilcoxon-Mann-Whitney rank sum test or bootstrap via <code>bootdif</code>.</li>
<li>Yes –&gt; are sample sizes equal?
<ol style="list-style-type: decimal">
<li>Balanced Design (equal sample sizes) - use pooled t test</li>
<li>Unbalanced Design - use Welch test</li>
</ol>
</li>
</ol>
</li>
</ol>
<div id="answers-for-the-three-tricky-examples" class="section level3" number="18.15.1">
<h3>
<span class="header-section-number">18.15.1</span> Answers for the Three “Tricky” Examples<a class="anchor" aria-label="anchor" href="#answers-for-the-three-tricky-examples"><i class="fas fa-link"></i></a>
</h3>
<p><em>Answer for 1.</em> Our first task is to identify the outcome and the exposure groups. Here, we are comparing the distribution of our outcome (triglyceride level in October) across two exposures: (a) receiving the intervention and (b) not receiving the intervention. We have a sample of 77 patients receiving the intervention, and a different sample of 77 patients receiving usual care. Each of the 77 subjects receiving the intervention is matched (on age and sex) to a specific subject not receiving the intervention. So, we can calculate paired differences by taking the triglyceride level for the exposed member of each pair and subtracting the triglyceride level for the usual care member of that same pair. Thus our comparison of the exposure groups should be accomplished using a <em>dependent</em> samples analysis, such as a paired t test.</p>
<p><em>Answer for 2.</em> Again, we begin by identfying the outcome (triglyceride level in October) and the exposure groups. Here, we compare two exposures: (a) receiving the intervention and (b) receiving usual care. We have a sample of 77 patients receiving the intervention, and a different sample of 77 patients receiving usual care. But there is no pairing or matching involved. There is no connection implied by the way that the data were collected that implies that, for example, patient 1 in the intervention group is linked to any particular subject in the usual care group. So we need to analyze the data using independent samples.</p>
<p><em>Answer for 3.</em> Once again, we identfy the outcome (now it is the within-subject <em>change</em> in triglyceride level from April to October) and the exposure groups. Here again, we compare two exposures: (a) receiving the intervention and (b) receiving usual care. We have a sample of 77 patients receiving the intervention, and a different sample of 77 patients receiving usual care. But again, there is no pairing or matching between the patients receiving the intervention and the patients receiving usual care. While each outcome value is a difference (or change) in triglyceride levels, there’s no connection implied by the way that the data were collected that implies that, for example, patient 1 in the intervention group is linked to any particular subject in the usual care group. So, again, we need to analyze the data using independent samples.</p>
<p>For more background and fundamental material, you might consider the Wikipedia pages on <a href="https://en.wikipedia.org/wiki/Paired_difference_test">Paired Difference Test</a> and on <a href="https://en.wikipedia.org/wiki/Blocking_(statistics)">Blocking (statistics)</a>.</p>

</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="the-ibuprofen-in-sepsis-randomized-clinical-trial.html"><span class="header-section-number">17</span> The Ibuprofen in Sepsis Randomized Clinical Trial</a></div>
<div class="next"><a href="hypothesis-testing-what-is-it-good-for.html"><span class="header-section-number">19</span> Hypothesis Testing: What is it good for?</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#comparing-means-with-paired-samples"><span class="header-section-number">18</span> Comparing Means with Paired Samples</a></li>
<li><a class="nav-link" href="#lead-in-the-blood-of-children"><span class="header-section-number">18.1</span> Lead in the Blood of Children</a></li>
<li>
<a class="nav-link" href="#the-lead-in-the-blood-of-children-study"><span class="header-section-number">18.2</span> The Lead in the Blood of Children Study</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#our-key-questions-for-a-paired-samples-comparison"><span class="header-section-number">18.2.1</span> Our Key Questions for a Paired Samples Comparison</a></li>
<li><a class="nav-link" href="#lead-study-caveats"><span class="header-section-number">18.2.2</span> Lead Study Caveats</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#exploratory-data-analysis-for-paired-samples"><span class="header-section-number">18.3</span> Exploratory Data Analysis for Paired Samples</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-paired-differences"><span class="header-section-number">18.3.1</span> The Paired Differences</a></li>
<li><a class="nav-link" href="#impact-of-matching---scatterplot-and-correlation"><span class="header-section-number">18.3.2</span> Impact of Matching - Scatterplot and Correlation</a></li>
</ul>
</li>
<li><a class="nav-link" href="#looking-at-separate-samples-using-pivot_longer"><span class="header-section-number">18.4</span> Looking at Separate Samples: Using pivot_longer</a></li>
<li>
<a class="nav-link" href="#estimating-the-difference-in-means-with-paired-samples"><span class="header-section-number">18.5</span> Estimating the Difference in Means with Paired Samples</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#paired-data-in-longer-format"><span class="header-section-number">18.5.1</span> Paired Data in Longer Format?</a></li></ul>
</li>
<li><a class="nav-link" href="#matched-pairs-vs.-two-independent-samples"><span class="header-section-number">18.6</span> Matched Pairs vs. Two Independent Samples</a></li>
<li><a class="nav-link" href="#estimating-the-population-mean-of-the-paired-differences"><span class="header-section-number">18.7</span> Estimating the Population Mean of the Paired Differences</a></li>
<li>
<a class="nav-link" href="#t-based-ci-for-population-mean-of-paired-differences"><span class="header-section-number">18.8</span> t-based CI for Population Mean of Paired Differences</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#method-1"><span class="header-section-number">18.8.1</span> Method 1</a></li>
<li><a class="nav-link" href="#method-2"><span class="header-section-number">18.8.2</span> Method 2</a></li>
<li><a class="nav-link" href="#method-3"><span class="header-section-number">18.8.3</span> Method 3</a></li>
<li><a class="nav-link" href="#method-4"><span class="header-section-number">18.8.4</span> Method 4</a></li>
<li><a class="nav-link" href="#method-5"><span class="header-section-number">18.8.5</span> Method 5</a></li>
<li><a class="nav-link" href="#assumptions"><span class="header-section-number">18.8.6</span> Assumptions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#bootstrap-ci-for-mean-difference-using-paired-samples"><span class="header-section-number">18.9</span> Bootstrap CI for mean difference using paired samples</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#assumptions-1"><span class="header-section-number">18.9.1</span> Assumptions</a></li></ul>
</li>
<li>
<a class="nav-link" href="#wilcoxon-signed-rank-based-ci-for-paired-samples"><span class="header-section-number">18.10</span> Wilcoxon Signed Rank-based CI for paired samples</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#assumptions-2"><span class="header-section-number">18.10.1</span> Assumptions</a></li></ul>
</li>
<li><a class="nav-link" href="#choosing-a-confidence-interval-approach"><span class="header-section-number">18.11</span> Choosing a Confidence Interval Approach</a></li>
<li><a class="nav-link" href="#conclusions-for-the-bloodlead-study"><span class="header-section-number">18.12</span> Conclusions for the bloodlead study</a></li>
<li><a class="nav-link" href="#the-sign-test"><span class="header-section-number">18.13</span> The Sign test</a></li>
<li>
<a class="nav-link" href="#paired-dependent-vs.-independent-samples"><span class="header-section-number">18.14</span> Paired (Dependent) vs. Independent Samples</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#three-tricky-examples"><span class="header-section-number">18.14.1</span> Three “Tricky” Examples</a></li></ul>
</li>
<li>
<a class="nav-link" href="#a-more-complete-decision-support-tool-comparing-means"><span class="header-section-number">18.15</span> A More Complete Decision Support Tool: Comparing Means</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#answers-for-the-three-tricky-examples"><span class="header-section-number">18.15.1</span> Answers for the Three “Tricky” Examples</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/THOMASELOVE/431-notes/blob/master/18_pairedsamples.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/THOMASELOVE/431-notes/edit/master/18_pairedsamples.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Science for Biological, Medical and Health Research: Notes for PQHS/CRSP/MPHP 431</strong>" was written by Thomas E. Love. It was last built on 2021-10-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
